<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Üreten Eller • Ana Sayfa</title>
  <link rel="icon" href="/assets/icons/favicon.png">
  <link rel="stylesheet" href="/css/site.css">

  <!-- Firebase init (mevcut dosyanız) -->
  <script type="module" src="/firebase-init.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header class="site-header" role="banner">
    <div class="header-wrap">
      <a href="/index.html" class="header-logo" aria-label="Anasayfa">
        <img src="/assets/icons/ureteneller.png" alt="logo">
        <span>Üreten Eller</span>
      </a>
      <div class="header-spacer"></div>
      <div class="header-actions">
        <button class="btn" data-act="open-login">Giriş Yap</button>
        <button class="btn primary" data-act="open-signup">Kayıt Ol</button>
        <label for="langSel" class="sr-only">Dil</label>
        <select id="langSel" class="lang-select" aria-label="Dil">
          <option value="tr" selected>Türkçe</option>
          <option value="en">English</option>
          <option value="de">Deutsch</option>
          <option value="ar">العربية</option>
        </select>
      </div>
    </div>
  </header>

  <!-- KATEGORİ SLIDER (5 sn rotasyon) -->
  <section class="cat-slider" aria-labelledby="catTitle">
    <h2 id="catTitle" class="sr-only">Kategoriler</h2>
    <div id="catSlider"></div>
  </section>

  <!-- İLAN PANELİ (TEK PANEL: Üstte her zaman Vitrin) -->
  <main class="listing-wrap" aria-labelledby="listTitle">
    <div class="panel-head">
      <h2 id="listTitle">Son İlanlar</h2>
      <div id="listNote" class="panel-sub"></div>
    </div>
    <div id="listingGrid" class="grid" aria-live="polite"></div>
    <div style="text-align:center;margin-top:.5rem">
      <button id="btnMore" class="btn" style="display:none">Daha fazla</button>
    </div>
  </main>

  <!-- AUTH MODAL (Login / Signup) -->
  <div id="authBackdrop" class="sr-only" aria-hidden="true"></div>
  <dialog id="authBox" aria-labelledby="authTitle" style="border:none;border-radius:16px;padding:0;max-width:560px;width:min(560px,95vw)">
    <form method="dialog" style="margin:0">
      <div style="padding:1rem;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;gap:.5rem">
        <div id="authTitle" style="font-weight:900">Hesabınla Devam Et</div>
        <div style="flex:1"></div>
        <button type="button" class="btn" id="authClose">Kapat</button>
      </div>
      <div style="padding:1rem">
        <div role="tablist" aria-label="Giriş/Kayıt" style="display:flex;gap:.5rem;margin-bottom:.6rem">
          <button type="button" class="btn" id="tabLogin" role="tab" aria-selected="true">Giriş Yap</button>
          <button type="button" class="btn" id="tabSignup" role="tab" aria-selected="false">Kayıt Ol</button>
        </div>

        <!-- LOGIN -->
        <div id="paneLogin">
          <div class="meta">
            <label for="lemail">E‑posta</label>
            <input id="lemail" type="email" required style="width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:.55rem .6rem">
          </div>
          <div class="meta" style="margin-top:.5rem">
            <label for="lpass">Şifre</label>
            <input id="lpass" type="password" required style="width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:.55rem .6rem">
          </div>
          <div style="display:flex;gap:.5rem;margin-top:.6rem">
            <button id="loginSubmit" class="btn primary" type="button" style="flex:1">Giriş Yap</button>
            <button id="forgotBtn" class="btn" type="button">Şifremi Unuttum</button>
          </div>
          <div id="lmsg" class="panel-sub" style="margin-top:.4rem"></div>
        </div>

        <!-- SIGNUP -->
        <div id="paneSignup" style="display:none">
          <div class="meta">
            <label for="sname">İsim</label>
            <input id="sname" type="text" required style="width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:.55rem .6rem">
          </div>
          <div class="meta" style="margin-top:.5rem">
            <label for="ssurname">Soyisim</label>
            <input id="ssurname" type="text" required style="width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:.55rem .6rem">
          </div>
          <div class="meta" style="margin-top:.5rem">
            <label for="semail">E‑posta</label>
            <input id="semail" type="email" required style="width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:.55rem .6rem">
          </div>
          <div class="meta" style="margin-top:.5rem">
            <label for="spass">Şifre (min 6)</label>
            <input id="spass" type="password" minlength="6" required style="width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:.55rem .6rem">
          </div>
          <div class="meta" style="margin-top:.5rem">
            <label for="spass2">Şifre (Tekrar)</label>
            <input id="spass2" type="password" minlength="6" required style="width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:.55rem .6rem">
          </div>
          <div style="display:flex;gap:.5rem;margin-top:.6rem">
            <button id="signupSubmit" class="btn primary" type="button" style="flex:1">Kayıt Ol</button>
          </div>
          <div id="smsg" class="panel-sub" style="margin-top:.4rem"></div>
        </div>
      </div>
    </form>
  </dialog>

  <!-- FOOTER (siyah legal alan) -->
  <footer class="site-footer" role="contentinfo">
    <div class="legal">
      <div class="legal-grid">
        <div>
          <a href="/legal/iletisim-impressum.html">İletişim / Impressum</a>
          <a href="/legal/gizlilik-politikasi.html">Gizlilik Politikası</a>
          <a href="/legal/kvkk-aydinlatma.html">KVKK Aydınlatma</a>
          <a href="/legal/cerez-politikasi.html">Çerez Politikası</a>
        </div>
        <div>
          <a href="/legal/kullanim-sartlari.html">Kullanım Şartları</a>
          <a href="/legal/mesafeli-satis-sozlesmesi.html">Mesafeli Satış Sözleşmesi</a>
          <a href="/legal/on-bilgilendirme-formu.html">Ön Bilgilendirme Formu</a>
          <a href="/legal/teslimat-iade-iptal.html">Teslimat & İade</a>
        </div>
        <div>
          <a href="/legal/topluluk-kurallari.html">Topluluk Kuralları</a>
          <a href="/legal/yasakli-urunler.html">Yasaklı Ürünler</a>
          <a href="#">Tüm Yasal Metinler</a>
        </div>
        <div>
          <span class="panel-sub">© <span id="yr"></span> Üreten Eller</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- SAYFA SCRIPTLERİ -->
  <script>
    // Yıl
    document.addEventListener('DOMContentLoaded', ()=>{
      const y=document.getElementById('yr'); if(y) y.textContent=new Date().getFullYear();
    });

    // Auth modal helper
    (function(){
      const dlg = document.getElementById('authBox');
      const closeBtn = document.getElementById('authClose');
      const tabLogin = document.getElementById('tabLogin');
      const tabSignup = document.getElementById('tabSignup');
      const paneLogin = document.getElementById('paneLogin');
      const paneSignup = document.getElementById('paneSignup');

      function open(which='login'){
        if(!dlg.open) dlg.showModal();
        sel(which);
      }
      function close(){ if(dlg.open) dlg.close(); }
      function sel(which){
        const isLogin = which==='login';
        tabLogin.setAttribute('aria-selected', isLogin);
        tabSignup.setAttribute('aria-selected', !isLogin);
        paneLogin.style.display = isLogin ? 'block' : 'none';
        paneSignup.style.display = isLogin ? 'none' : 'block';
      }

      document.addEventListener('ue-open-auth', (e)=>{
        const which = e.detail?.which || 'login';
        open(which);
        // redirect paramını dialog dataset’ine koy
        if(e.detail?.redirect) dlg.dataset.redirect = e.detail.redirect;
      });

      document.querySelector('[data-act="open-login"]').onclick = ()=> open('login');
      document.querySelector('[data-act="open-signup"]').onclick = ()=> open('signup');
      tabLogin.onclick = ()=> sel('login');
      tabSignup.onclick = ()=> sel('signup');
      closeBtn.onclick = close;

      // URL param ile açılış
      const u = new URL(location.href);
      const pAuth = u.searchParams.get('auth');
      const pRed = u.searchParams.get('redirect');
      if(pAuth){
        const ev = new CustomEvent('ue-open-auth',{ detail:{ which:pAuth, redirect:pRed }});
        document.dispatchEvent(ev);
      }

      // TR hata mesajları
      const TR_ERR = {
        'auth/invalid-email': 'E‑posta geçersiz.',
        'auth/user-disabled': 'Hesap devre dışı.',
        'auth/user-not-found': 'Bu e‑posta ile kullanıcı bulunamadı.',
        'auth/wrong-password': 'Şifre hatalı.',
        'auth/too-many-requests': 'Çok fazla deneme. Lütfen sonra tekrar deneyin.',
        'default': 'İşlem başarısız. Lütfen tekrar deneyin.'
      };
      const mapErr = (e)=> TR_ERR[e?.code] || e?.message || TR_ERR.default;

      // Giriş
      document.getElementById('loginSubmit').onclick = async ()=>{
        const email = document.getElementById('lemail').value.trim();
        const pass  = document.getElementById('lpass').value;
        const box   = document.getElementById('lmsg'); box.textContent='…';
        try{
          const { signInWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js');
          await signInWithEmailAndPassword(auth, email, pass);
          box.textContent='Giriş başarılı ✔︎';
          const back = document.getElementById('authBox').dataset.redirect || new URL(location.href).searchParams.get('redirect');
          setTimeout(()=>{ location.href = back || location.href.split('?')[0]; }, 300);
        }catch(err){ box.textContent = mapErr(err); }
      };

      // Şifre sıfırlama
      document.getElementById('forgotBtn').onclick = async ()=>{
        const email = document.getElementById('lemail').value.trim();
        const box   = document.getElementById('lmsg');
        if(!email){ box.textContent='E‑posta giriniz.'; return; }
        try{
          const { sendPasswordResetEmail } = await import('https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js');
          await sendPasswordResetEmail(auth, email);
          box.textContent='Sıfırlama e‑postası gönderildi.';
        }catch(err){ box.textContent = mapErr(err); }
      };

      // Kayıt
      document.getElementById('signupSubmit').onclick = async ()=>{
        const name = document.getElementById('sname').value.trim();
        const surname = document.getElementById('ssurname').value.trim();
        const email = document.getElementById('semail').value.trim();
        const pass  = document.getElementById('spass').value;
        const pass2 = document.getElementById('spass2').value;
        const box   = document.getElementById('smsg');
        if(pass!==pass2){ box.textContent='Şifreler eşleşmiyor.'; return; }
        box.textContent='…';
        try{
          const { createUserWithEmailAndPassword, updateProfile, sendEmailVerification } = await import('https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js');
          const res = await createUserWithEmailAndPassword(auth, email, pass);
          await updateProfile(res.user, { displayName: `${name} ${surname}`.trim() });
          try{ await sendEmailVerification(res.user); }catch{}
          box.textContent='Kayıt başarılı. Lütfen e‑posta doğrulamasını tamamlayınız.';
        }catch(err){ box.textContent = mapErr(err); }
      };
    })();
  </script>

  <!-- Sayfa davranışları (kategori/ilanlar) -->
  <script src="/js/index.page.js"></script>
</body>
</html>
