<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Üreten Eller • Ana Sayfa</title>
  <meta name="description" content="Üreten Eller: El emeği ürünler, yöresel lezzetler ve daha fazlası. Kategorilere göz atın, arayın, ilan verin." />
  <link rel="icon" href="/assets/icons/favicon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:#0b1220;-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    .page{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
    .topbar{position:sticky;top:0;z-index:40;backdrop-filter:saturate(140%) blur(8px);background:rgba(255,255,255,.8);border-bottom:1px solid #e5e7eb}
    .topbar-inner{max-width:1200px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}

    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{width:36px;height:36px;border-radius:10px;background:#000 url('/assets/icons/favicon.png') center/cover no-repeat;box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)}
    .brand h1{font-size:18px;letter-spacing:.2px;margin:0;font-weight:800}

    .actions{display:flex;align-items:center;gap:8px}
    .lang{border:1px solid #e5e7eb;border-radius:10px;padding:6px 10px;font-weight:600;background:#fff}

    .wrap{max-width:1200px;margin:0 auto;padding:18px 16px;display:grid;grid-template-columns:280px 1fr;gap:16px}
    @media (max-width: 980px){.wrap{grid-template-columns:1fr}.sidebar{order:2}.content{order:1}}

    .sidebar{position:relative}
    .search{position:sticky;top:70px;background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:10px 12px;display:flex;align-items:center;gap:8px;box-shadow:0 2px 10px rgba(0,0,0,.03)}
    .search input{flex:1;border:0;outline:0;background:transparent;font-size:14px}

    .catbox{margin-top:12px;border:1px solid #e5e7eb;border-radius:16px;overflow:hidden}
    .cathead{font-size:12px;font-weight:700;letter-spacing:.4px;text-transform:uppercase;color:#6b7280;padding:10px 14px;background:#fafafa;border-bottom:1px solid #eee}
    .catlist{max-height:68vh;overflow:auto}

    .cat{border-bottom:1px dashed #eee}
    .cat:last-child{border-bottom:0}
    .cat > button{width:100%;text-align:left;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;background:#fff;border:0;cursor:pointer;font-weight:600}
    .cat > button:hover{background:#fafafa}
    .cat-title{display:flex;align-items:center;gap:8px}
    .chev{transition:transform .2s ease}
    .cat[aria-expanded="true"] .chev{transform:rotate(90deg)}

    .sublist{display:none;padding:8px 10px 14px 38px}
    .sublist a{display:block;padding:6px 4px;border-radius:8px;font-size:14px;color:#374151}
    .sublist a:hover{background:#f3f4f6}

    .hero{position:relative;border:1px solid #e5e7eb;border-radius:20px;padding:22px 18px;display:grid;grid-template-columns:1.5fr 1fr;gap:20px;align-items:center;overflow:hidden}
    .hero::after{content:"";position:absolute;inset:-60% -40% auto auto;aspect-ratio:1/1;background:radial-gradient(closest-side,rgba(255,215,0,.15),transparent 70%)}
    @media (max-width: 900px){.hero{grid-template-columns:1fr}}
    .hero h2{font-size:28px;margin:0 0 10px 0;letter-spacing:.2px}
    .hero p{margin:0 0 16px 0;color:#4b5563}

    .cta-row{display:flex;flex-wrap:wrap;gap:8px}

    .grid{margin-top:16px;display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width: 1100px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 640px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;background:#fff;box-shadow:0 10px 30px rgba(0,0,0,.04)}
    .card .ph{aspect-ratio:16/11;background:linear-gradient(180deg,#f3f4f6,#fff)}
    .card .body{padding:12px}
    .card .title{font-weight:700;margin:0 0 4px 0}
    .card .meta{font-size:12px;color:#6b7280}
    .card .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px}

    .btn{--gold:#caa552;--shine:rgba(255,255,255,.7);--ink:#0b1220;appearance:none;border:0;cursor:pointer;font-weight:800;border-radius:12px;padding:10px 14px;position:relative;isolation:isolate;transition:transform .06s ease, box-shadow .2s ease;user-select:none}
    .btn:active{transform:translateY(1px)}
    .btn.gold{color:#111;background:
        radial-gradient(120% 120% at 0% 0%, rgba(255,255,255,.75), transparent 35%),
        linear-gradient(180deg, #f7e7b5, #e8c972 40%, #d7b45d 55%, #caa552 80%, #b79343);
      border:1px solid #b18a37;box-shadow:inset 0 1px 0 var(--shine), 0 4px 18px rgba(202,165,82,.35)}
    .btn.ghost{background:#fff;border:1px solid #e5e7eb}

    .auth-badge{display:flex;align-items:center;gap:10px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px}
    .avatar{width:28px;height:28px;border-radius:50%;background:#f3f4f6;overflow:hidden}

    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.32);z-index:60;padding:16px}
    .modal[open]{display:grid}
    .sheet{width:min(520px,96vw);background:#fff;border-radius:18px;border:1px solid #e5e7eb;box-shadow:0 30px 60px rgba(0,0,0,.15);overflow:hidden}
    .sheet header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #eee}
    .sheet header h3{margin:0;font-size:18px}
    .sheet .inner{padding:16px}

    .form{display:grid;gap:10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:560px){.row2{grid-template-columns:1fr}}
    .input{display:flex;flex-direction:column;gap:6px}
    .input label{font-size:12px;color:#6b7280}
    .input input, .input select{border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;font-size:14px}
    .pw{position:relative}
    .pw input{padding-right:38px}
    .pw .toggle{position:absolute;right:8px;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer}

    .hint{font-size:12px;color:#6b7280}
    .error{color:#b91c1c}

    .legal{background:#000;color:#fff}
    .legal .inner{max-width:1200px;margin:0 auto;padding:16px}
    .legal a{color:#fff;opacity:.9}
    .legal a:hover{opacity:1;text-decoration:underline}
    .legal .links{display:flex;flex-wrap:wrap;gap:14px;align-items:center}
    .legal .row{display:flex;justify-content:space-between;align-items:center;gap:12px}
    @media (max-width:800px){.legal .row{flex-direction:column;align-items:flex-start}}

    /* Empty state for listings */
    .empty{
      border:1px dashed #e5e7eb; border-radius:16px; padding:18px; text-align:center; color:#6b7280;
      background:linear-gradient(180deg,#fafafa,#fff)
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <h1 data-i18n="brand">Üreten Eller</h1>
        </div>
        <div class="actions">
          <select id="lang" class="lang" aria-label="Dil">
            <option value="tr">Türkçe</option>
            <option value="en">English</option>
            <option value="ar">العربية</option>
            <option value="de">Deutsch</option>
          </select>
          <button class="btn gold" id="postBtn" data-i18n="post">İlan Ver</button>
          <div id="authArea" class="auth-badge" style="display:none">
            <div class="avatar"><img id="uAvatar" alt="" /></div>
            <div id="uName" class="hint">Kullanıcı</div>
            <button class="btn ghost" id="signOutBtn" data-i18n="signOut">Çıkış</button>
          </div>
          <button class="btn ghost" id="signInBtn" data-i18n="signIn">Giriş / Kayıt</button>
        </div>
      </div>
    </div>

    <main class="wrap">
      <aside class="sidebar">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M15.5 15.5L21 21" stroke="#111" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#111" stroke-width="1.6"/></svg>
          <input id="q" data-i18n-placeholder="searchPlaceholder" placeholder="Ara: ürün, kategori, ilçe…" />
          <button class="btn gold" id="searchBtn" aria-label="Ara" data-i18n="search">Ara</button>
        </div>

        <div class="catbox" aria-label="Kategoriler">
          <div class="cathead" data-i18n="categories">Kategoriler</div>
          <div id="catlist" class="catlist"></div>
        </div>
      </aside>

      <section class="content">
        <div class="hero">
          <div>
            <h2 id="heroTitle">El emeği & yerel lezzetler tek çatı altında</h2>
            <p id="heroDesc">Üreten kadınlardan, ev yapımı lezzetlerden, el işi tasarımlardan alışveriş yapın. Konumunuza göre arayın, kategorilerden keşfedin.</p>
            <div class="cta-row">
              <button class="btn gold" id="browseBtn" data-i18n="browse">Kategorileri Keşfet</button>
            </div>
          </div>
          <div>
            <img alt="Üreten Eller illüstrasyon" src="/assets/icons/ureteneller.png" onerror="this.src='/assets/img/avatar-default.png'" />
          </div>
        </div>

        <!-- Showcase: removed placeholder/fake listings. Keep container for future dynamic content. -->
        <div class="grid" id="showcase">
          <div class="empty" data-i18n="empty.listings">Şimdilik gösterilecek ilan yok. Kategorilerden keşfedin veya arama yapın.</div>
        </div>
      </section>
    </main>

    <footer class="legal">
      <div class="inner">
        <div class="row">
          <div class="links">
            <a href="/legal/kullanim-sartlari.html" data-i18n="legal.terms">Kullanım Şartları</a>
            <a href="/legal/gizlilik-politikasi.html" data-i18n="legal.privacy">Gizlilik Politikası</a>
            <a href="/legal/kvkk-aydinlatma.html" data-i18n="legal.kvkk">KVKK Aydınlatma</a>
            <a href="/legal/topluluk-kurallari.html" data-i18n="legal.community">Topluluk Kuralları</a>
            <a href="/legal/yasakli-urunler.html" data-i18n="legal.prohibited">Yasaklı Ürünler</a>
            <a href="/legal/mesafeli-satis-sozlesmesi.html" data-i18n="legal.distance">Mesafeli Satış</a>
            <a href="/legal/on-bilgilendirme-formu.html" data-i18n="legal.preinfo">Ön Bilgilendirme</a>
            <a href="/legal/teslimat-iade-iptal.html" data-i18n="legal.return">Teslimat/İade</a>
            <a href="/iletisim-impressum.html" data-i18n="legal.contact">İletişim</a>
          </div>
          <div class="hint">© <span id="y"></span> <span data-i18n="brand">Üreten Eller</span></div>
        </div>
      </div>
    </footer>
  </div>

  <!-- ===== Auth Modal ===== -->
  <dialog class="modal" id="authModal" aria-labelledby="authTitle">
    <div class="sheet" role="document">
      <header>
        <h3 id="authTitle" data-i18n="auth.title">Giriş Yap / Kayıt Ol</h3>
        <button class="btn ghost" data-close aria-label="Kapat">✕</button>
      </header>
      <div class="inner">
        <div class="hint" style="margin-bottom:10px" data-i18n="auth.hint">Sipariş vermek veya profilleri ziyaret etmek için giriş yapmalısınız.</div>
        <div class="form" style="margin-bottom:16px">
          <div class="input"><label data-i18n="auth.email">E-posta</label><input id="li_email" type="email" placeholder="ornek@mail.com" autocomplete="username"/></div>
          <div class="input pw"><label data-i18n="auth.password">Şifre</label><input id="li_pass" type="password" placeholder="••••••••" autocomplete="current-password"/><button class="toggle" data-toggle="li_pass" aria-label="Şifreyi göster">👁️</button></div>
          <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
            <button class="btn gold" id="loginBtn" data-i18n="auth.login">Giriş Yap</button>
            <button class="btn ghost" id="forgotBtn" type="button" data-i18n="auth.forgot">Şifremi Unuttum</button>
          </div>
          <div style="margin-top:10px;display:flex;justify-content:center">
            <button class="btn ghost" id="googleBtn" data-i18n="auth.google">Google ile Giriş</button>
          </div>
        </div>
        <hr style="border:0;border-top:1px solid #eee;margin:8px 0 14px">
        <details>
          <summary style="cursor:pointer;font-weight:700" data-i18n="auth.noAccount">Hesabın yok mu? Kayıt ol</summary>
          <div class="form" style="margin-top:10px">
            <div class="row2">
              <div class="input"><label data-i18n="auth.username">Kullanıcı Adı</label><input id="su_username" maxlength="24" placeholder="@kullanici"/></div>
              <div class="input"><label data-i18n="auth.name">Ad Soyad</label><input id="su_name" placeholder="Adınız Soyadınız"/></div>
            </div>
            <div class="row2">
              <div class="input"><label data-i18n="auth.province">İl</label>
                <select id="su_province"></select>
              </div>
              <div class="input"><label data-i18n="auth.district">İlçe</label><input id="su_district" placeholder="İlçeniz"/></div>
            </div>
            <div class="row2">
              <div class="input"><label data-i18n="auth.email">E-posta</label><input id="su_email" type="email" placeholder="ornek@mail.com" autocomplete="email"/></div>
              <div class="input pw"><label data-i18n="auth.password">Şifre</label><input id="su_pass" type="password" placeholder="En az 6 karakter" autocomplete="new-password"/><button class="toggle" data-toggle="su_pass" aria-label="Şifreyi göster">👁️</button></div>
            </div>
            <div class="input pw"><label data-i18n="auth.password2">Şifre (Tekrar)</label><input id="su_pass2" type="password" placeholder="Şifreyi tekrar yazın" autocomplete="new-password"/><button class="toggle" data-toggle="su_pass2" aria-label="Şifreyi göster">👁️</button></div>
            <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
              <button class="btn gold" id="registerBtn" data-i18n="auth.register">Kayıt Ol</button>
              <div class="hint" id="verifyHint">Kayıtla birlikte <strong>mail doğrulama</strong> gönderilir. Gelen kutusu ve <strong>SPAM</strong> klasörünü kontrol edin.</div>
            </div>
          </div>
        </details>
      </div>
    </div>
  </dialog>

  <!-- If you have an external initializer, keep it. It can set window.FIREBASE_CONFIG or call initializeApp itself. -->
  <script type="module" src="/firebase-init.js"></script>

  <script type="module">
    // ===== Firebase APP INIT (Fix: initializeApp before getAuth) =====
    import { initializeApp, getApps } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, updateProfile, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js';

    // Allow three ways to initialize:
    let app;
    try{
      if (window.__firebaseApp) {
        app = window.__firebaseApp;
      } else if (getApps().length) {
        app = getApps()[0];
      } else if (window.FIREBASE_CONFIG) {
        app = initializeApp(window.FIREBASE_CONFIG);
        window.__firebaseApp = app;
      } else {
        // Placeholder (you already have /firebase-init.js that initializes correctly)
        const demoConfig = {
          apiKey: "demo",
          authDomain: "demo",
          projectId: "demo",
          appId: "demo"
        };
        app = initializeApp(demoConfig);
        window.__firebaseApp = app;
        console.warn('Demo Firebase config is in use on this page. Real init should happen in /firebase-init.js');
      }
    }catch(e){ console.error('Firebase init error:', e); }

    let auth; try { auth = app ? getAuth(app) : null; } catch(e){ console.error('getAuth error', e); auth = null; }

    // ===== I18N =====
    const I18N = {
      tr: { brand: 'Üreten Eller', post: 'İlan Ver', signIn: 'Giriş / Kayıt', signOut: 'Çıkış', searchPlaceholder: 'Ara: ürün, kategori, ilçe…', search: 'Ara', categories: 'Kategoriler', browse: 'Kategorileri Keşfet', actions: { order: 'Sipariş Ver', add: 'Sepete Ekle', buy: 'Satın Al', visit: 'Profili Ziyaret Et' }, auth: { title: 'Giriş Yap / Kayıt Ol', hint: 'Sipariş vermek veya profilleri ziyaret etmek için giriş yapmalısınız.', email: 'E-posta', password: 'Şifre', password2: 'Şifre (Tekrar)', login: 'Giriş Yap', forgot: 'Şifremi Unuttum', google: 'Google ile Giriş', noAccount: 'Hesabın yok mu? Kayıt ol', username: 'Kullanıcı Adı', name: 'Ad Soyad', province: 'İl', district: 'İlçe', register: 'Kayıt Ol', verifyHint: 'Kayıtla birlikte <strong>mail doğrulama</strong> gönderilir. Gelen kutusu ve <strong>SPAM</strong> klasörünü kontrol edin.' }, legal: { terms: 'Kullanım Şartları', privacy: 'Gizlilik Politikası', kvkk: 'KVKK Aydınlatma', community: 'Topluluk Kuralları', prohibited: 'Yasaklı Ürünler', distance: 'Mesafeli Satış', preinfo: 'Ön Bilgilendirme', return: 'Teslimat/İade', contact: 'İletişim' }, heroLines: [ { t: 'El emeği & yerel lezzetler tek çatı altında', d: 'Üreten kadınlardan, ev yapımı lezzetlerden, el işi tasarımlardan alışveriş yapın. Konumunuza göre arayın, kategorilerden keşfedin.' }, { t: 'Mahallenden üreticiye doğrudan destek', d: 'Yakınınızdaki üreticileri bulun, taze ve el emeği ürünleri keşfedin.' }, { t: 'Kendi ürününü kolayca satışa çıkar', d: 'Ücretsiz ilan ver, güvenli mesajlaşma ve sipariş yönetimi ile hızlı başla.' } ], cats: { yemek: '🍲 Yemekler', pasta: '🎂 Pasta & Tatlı', sos: '🫙 Reçel • Turşu • Sos', yoresel: '🌾 Yöresel / Kışlık', diet: '🥗 Diyet / Vegan / GF', taki: '💍 Takı', bebek: '👶 Bebek & Çocuk', orgu: '🧶 Örgü / Triko', terzi: '✂️ Dikiş / Terzilik', makrome: '🧵 Makrome & Dekor', evdekor: '🏠 Ev Dekor & Aksesuar', mum: '🕯️ Mum & Kokulu', kozmetik: '🧼 Doğal Sabun & Kozmetik', amigurumi: '🧸 Amigurumi & Oyuncak' }, sub: { evyemek: 'Ev yemekleri', borek: 'Börek-çörek', corba: 'Çorba', zeytiny: 'Zeytinyağlı', pilav: 'Pilav-makarna', et: 'Et-tavuk', kahvalti: 'Kahvaltılık', meze: 'Meze', dondur: 'Dondurulmuş', cocuk: 'Çocuk öğünleri', diyetvegf: 'Diyet/vegan/gf', yaspasta: 'Yaş pasta', kek: 'Kek-cupcake', kurabiye: 'Kurabiye', serbetli: 'Şerbetli', sutlu: 'Sütlü', cheese: 'Cheesecake', diyettat: 'Diyet tatlı', cikolata: 'Çikolata/şekerleme', dogumset: 'Doğum günü setleri', recel: 'Reçel-marmelat', pekmez: 'Pekmez', tursu: 'Turşu', dom: 'Domates/biber sos', acios: 'Acı sos', salca: 'Salça', sirke: 'Sirke', konserve: 'Konserve', eriste: 'Erişte', tarhana: 'Tarhana', yufka: 'Yufka', manti: 'Mantı', kurut: 'Kurutulmuş', salca2: 'Salça', sirke2: 'Sirke', konserve2: 'Konserve', fit: 'Fit tabaklar', vegan: 'Vegan yemekler', gf: 'GF unlu mamuller', sekersiz: 'Şekersiz tatlı', keto: 'Keto ürün', protein: 'Protein atıştırmalık', bileklik: 'Bileklik', kolye: 'Kolye', kupe: 'Küpe', yuzuk: 'Yüzük', halhal: 'Halhal', bros: 'Broş', set: 'Setler', isimli: 'Kişiye özel', makrome: 'Makrome', dogaltas: 'Doğal taş', recine: 'Reçine', telsarma: 'Tel sarma', fig: 'Figürler', cingirak: 'Çıngırak', dis: 'Diş kaşıyıcı', bezoy: 'Bez oyuncak/kitap', montessori: 'Montessori', set2: 'Setler', patik: 'Patik-bere', battaniye: 'Battaniye', onluk: 'Önlük', lohusa: 'Lohusa seti', sac: 'Saç aksesuarı', giyim: 'El emeği kıyafet', hirka: 'Hırka', kazak: 'Kazak', atkibere: 'Atkı-bere', panco: 'Panço', sal: 'Şal', corap: 'Çorap', lif: 'Lif takımı', bepektk: 'Bebek takımı', yelek: 'Yelek', kirlen: 'Kırlent-örtü', igneoyasi: 'İğne oyası', paca: 'Paça/onarım', fermuar: 'Fermuar değişimi', perde: 'Perde', nevresim: 'Nevresim', masa: 'Masa örtüsü', ozel: 'Özel dikim', kostum: 'Kostüm', duvar: 'Duvar süzü', saksi: 'Saksı askısı', anahtar: 'Anahtarlık', avize: 'Avize', runner: 'Runner', sepet: 'Sepet', raf: 'Raf/dekor', kece: 'Keçe işleri', kirlent: 'Kırlent', kapi: 'Kapı süsü', tepsi: 'Tepsi süs', cerceve: 'Çerçeve', ruya: 'Rüya kapanı', tablo: 'Tablo', soya: 'Soya/balmumu', tas: 'Kokulu taş', sprey: 'Oda spreyi', tutsu: 'Tütsü', jel: 'Jel mum', hediye: 'Hediye seti', zeytin: 'Zeytinyağlı sabun', bitkisel: 'Bitkisel sabun', sampuan: 'Katı şampuan', balm: 'Dudak balmı', krem: 'Krem/merhem', banyotuzu: 'Banyo tuzu', lavanta: 'Lavanta kesesi', anahtar2: 'Anahtarlık', magnet: 'Magnet', kolek: 'Koleksiyon', dekorbebek: 'Dekor bebek' }, item: { manti: { title: 'Ev Yapımı Mantı', meta: 'Kadıköy • 350 TL' }, makrome: { title: 'Makrome Duvar Süsü', meta: 'Konya • 420 TL' }, sabun: { title: 'Zeytinyağlı Sabun', meta: 'Ayvalık • 95 TL' } } },
      en: { brand: 'Üreten Eller', post: 'Post Listing', signIn: 'Sign In / Register', signOut: 'Sign Out', searchPlaceholder: 'Search: product, category, district…', search: 'Search', categories: 'Categories', browse: 'Browse Categories', actions: { order: 'Order', add: 'Add to Cart', buy: 'Buy Now', visit: 'View Profile' }, auth: { title: 'Sign In / Register', hint: 'You need to sign in to place orders or view profiles.', email: 'Email', password: 'Password', password2: 'Password (Again)', login: 'Sign In', forgot: 'Forgot Password', google: 'Sign in with Google', noAccount: 'No account? Register', username: 'Username', name: 'Full Name', province: 'Province', district: 'District', register: 'Register', verifyHint: 'A verification email will be sent. Please check your Inbox and <strong>SPAM</strong>.' }, legal: { terms: 'Terms', privacy: 'Privacy', kvkk: 'KVKK Notice', community: 'Community Guidelines', prohibited: 'Prohibited Items', distance: 'Distance Sales', preinfo: 'Pre-Information', return: 'Delivery/Returns', contact: 'Contact' }, heroLines: [ { t: 'Handmade & local flavors in one place', d: 'Shop from local women producers and artisans. Search by location or explore by categories.' }, { t: 'Support nearby makers directly', d: 'Find producers around you and discover fresh, handmade goods.' }, { t: 'List your product in minutes', d: 'Create a free listing and start selling with secure messaging and orders.' } ], cats: { yemek: '🍲 Meals', pasta: '🎂 Cakes & Desserts', sos: '🫙 Jam • Pickle • Sauce', yoresel: '🌾 Local / Seasonal', diet: '🥗 Diet / Vegan / GF', taki: '💍 Jewelry', bebek: '👶 Baby & Kids', orgu: '🧶 Knitting / Crochet', terzi: '✂️ Sewing / Tailor', makrome: '🧵 Macrame & Decor', evdekor: '🏠 Home Decor & Accessories', mum: '🕯️ Candles & Scents', kozmetik: '🧼 Natural Soap & Cosmetics', amigurumi: '🧸 Amigurumi & Toys' }, sub: {}, item: { manti: { title: 'Homemade Mantı', meta: 'Kadıköy • 350 TRY' }, makrome: { title: 'Macrame Wall Hanging', meta: 'Konya • 420 TRY' }, sabun: { title: 'Olive Oil Soap', meta: 'Ayvalık • 95 TRY' } } },
      ar: { brand: 'أُنتِجَت بالأيدي', post: 'أنشئ إعلانًا', signIn: 'تسجيل الدخول / إنشاء حساب', signOut: 'تسجيل الخروج', searchPlaceholder: 'ابحث: منتج، فئة، حي…', search: 'بحث', categories: 'الفئات', browse: 'استكشاف الفئات', actions: { order: 'اطلب الآن', add: 'أضِف إلى السلة', buy: 'اشتري الآن', visit: 'زيارة الملف' }, auth: { title: 'تسجيل الدخول / إنشاء حساب', hint: 'يلزم تسجيل الدخول لإتمام الطلب أو عرض الملفات.', email: 'البريد الإلكتروني', password: 'كلمة المرور', password2: 'تأكيد كلمة المرور', login: 'تسجيل الدخول', forgot: 'نسيت كلمة المرور', google: 'تسجيل عبر Google', noAccount: 'ليس لديك حساب؟ سجّل', username: 'اسم المستخدم', name: 'الاسم الكامل', province: 'الولاية', district: 'المنطقة', register: 'إنشاء حساب', verifyHint: 'سيتم إرسال بريد تفعيل. يرجى فحص الوارد و<strong>الرسائل غير المرغوب فيها</strong>.' }, legal: { terms: 'الشروط', privacy: 'الخصوصية', kvkk: 'إشعار KVKK', community: 'إرشادات المجتمع', prohibited: 'المنتجات الممنوعة', distance: 'البيع عن بُعد', preinfo: 'معلومات أولية', return: 'التسليم/الإرجاع', contact: 'اتصال' }, heroLines: [ { t: 'حِرَف ونكهات محلية في مكان واحد', d: 'تسوّق من المنتجين المحليين والحرفيين. ابحث حسب الموقع أو استكشف الفئات.' }, { t: 'ادعم المنتجين القريبين منك مباشرة', d: 'اكتشف المنتجات الطازجة والمصنوعة يدويًا حولك.' }, { t: 'اعرض منتجك بسهولة', d: 'أنشئ إعلانًا مجانًا وابدأ البيع برسائل وطلبات آمنة.' } ], cats: { yemek: '🍲 وجبات', pasta: '🎂 كعك وحلويات', sos: '🫙 مربى • مخللات • صلصات', yoresel: '🌾 محلي/موسمي', diet: '🥗 حِمية/نباتي/خالٍ من الغلوتين', taki: '💍 مجوهرات', bebek: '👶 أطفال', orgu: '🧶 حياكة/كروشيه', terzi: '✂️ خياطة/تفصيل', makrome: '🧵 مكرمية وديكور', evdekor: '🏠 ديكور المنزل', mum: '🕯️ شموع وروائح', kozmetik: '🧼 صابون طبيعي ومستحضرات', amigurumi: '🧸 أميجورومي وألعاب' }, sub: {}, item: { manti: { title: 'مانطي منزلي', meta: 'Kadıköy • 350 ليرة' }, makrome: { title: 'تعليقة جدارية مكرمية', meta: 'Konya • 420 ليرة' }, sabun: { title: 'صابون بزيت الزيتون', meta: 'Ayvalık • 95 ليرة' } } },
      de: { brand: 'Üreten Eller', post: 'Anzeige erstellen', signIn: 'Anmelden / Registrieren', signOut: 'Abmelden', searchPlaceholder: 'Suche: Produkt, Kategorie, Bezirk…', search: 'Suchen', categories: 'Kategorien', browse: 'Kategorien entdecken', actions: { order: 'Bestellen', add: 'In den Warenkorb', buy: 'Jetzt kaufen', visit: 'Profil ansehen' }, auth: { title: 'Anmelden / Registrieren', hint: 'Zum Bestellen oder Anzeigen von Profilen musst du angemeldet sein.', email: 'E-Mail', password: 'Passwort', password2: 'Passwort (Wiederholung)', login: 'Anmelden', forgot: 'Passwort vergessen', google: 'Mit Google anmelden', noAccount: 'Kein Konto? Registrieren', username: 'Benutzername', name: 'Vollständiger Name', province: 'Provinz', district: 'Bezirk', register: 'Registrieren', verifyHint: 'Eine Bestätigungs-E-Mail wird gesendet. Bitte Posteingang und <strong>SPAM</strong> prüfen.' }, legal: { terms: 'Nutzungsbedingungen', privacy: 'Datenschutz', kvkk: 'KVKK Hinweis', community: 'Community-Richtlinien', prohibited: 'Verbotene Artikel', distance: 'Fernabsatz', preinfo: 'Vorabinformation', return: 'Lieferung/Retouren', contact: 'Kontakt' }, heroLines: [ { t: 'Handgemachtes & lokale Köstlichkeiten', d: 'Kaufe bei lokalen Produzentinnen und Handwerker:innen. Suche nach Standort oder stöbere nach Kategorien.' }, { t: 'Unterstütze Hersteller in deiner Nähe', d: 'Finde Produzenten in der Umgebung und entdecke handgemachte Produkte.' }, { t: 'Stelle dein Produkt in Minuten ein', d: 'Kostenlose Anzeige, sichere Nachrichten und Bestellungen.' } ], cats: { yemek: '🍲 Gerichte', pasta: '🎂 Kuchen & Desserts', sos: '🫙 Marmelade • Eingelegtes • Saucen', yoresel: '🌾 Regional / Saisonal', diet: '🥗 Diät / Vegan / GF', taki: '💍 Schmuck', bebek: '👶 Baby & Kinder', orgu: '🧶 Stricken / Häkeln', terzi: '✂️ Schneiderei', makrome: '🧵 Makramee & Deko', evdekor: '🏠 Wohndeko & Accessoires', mum: '🕯️ Kerzen & Düfte', kozmetik: '🧼 Naturseife & Kosmetik', amigurumi: '🧸 Amigurumi & Spielzeug' }, sub: {}, item: { manti: { title: 'Hausgemachte Mantı', meta: 'Kadıköy • 350 TRY' }, makrome: { title: 'Makramee Wandbehang', meta: 'Konya • 420 TRY' }, sabun: { title: 'Olivenölseife', meta: 'Ayvalık • 95 TRY' } } }
    };

    // Provinces (TR)
    const PROVINCES = ["Adana","Adıyaman","Afyonkarahisar","Ağrı","Aksaray","Amasya","Ankara","Antalya","Ardahan","Artvin","Aydın","Balıkesir","Bartın","Batman","Bayburt","Bilecik","Bingöl","Bitlis","Bolu","Burdur","Bursa","Çanakkale","Çankırı","Çorum","Denizli","Diyarbakır","Düzce","Edirne","Elazığ","Erzincan","Erzurum","Eskişehir","Gaziantep","Giresun","Gümüşhane","Hakkari","Hatay","Iğdır","Isparta","İstanbul","İzmir","Kahramanmaraş","Karabük","Karaman","Kars","Kastamonu","Kayseri","Kırıkkale","Kırklareli","Kırşehir","Kilis","Kocaeli","Konya","Kütahya","Malatya","Manisa","Mardin","Mersin","Muğla","Muş","Nevşehir","Niğde","Ordu","Osmaniye","Rize","Sakarya","Samsun","Siirt","Sinop","Sivas","Şanlıurfa","Şırnak","Tekirdağ","Tokat","Trabzon","Tunceli","Uşak","Van","Yalova","Yozgat","Zonguldak"].sort((a,b)=>a.localeCompare(b,'tr'));

    // Categories base (ids + TR labels for subs; titles are translated via I18N)
    const CATS = [
      {id:'yemek', subs:[["evyemek","Ev yemekleri"],["borek","Börek-çörek"],["corba","Çorba"],["zeytiny","Zeytinyağlı"],["pilav","Pilav-makarna"],["et","Et-tavuk"],["kahvalti","Kahvaltılık"],["meze","Meze"],["dondur","Dondurulmuş"],["cocuk","Çocuk öğünleri"],["diyetvegf","Diyet/vegan/gf"]]},
      {id:'pasta', subs:[["yaspasta","Yaş pasta"],["kek","Kek-cupcake"],["kurabiye","Kurabiye"],["serbetli","Şerbetli"],["sutlu","Sütlü"],["cheese","Cheesecake"],["diyettat","Diyet tatlı"],["cikolata","Çikolata/şekerleme"],["dogumset","Doğum günü setleri"]]},
      {id:'sos', subs:[["recel","Reçel-marmelat"],["pekmez","Pekmez"],["tursu","Turşu"],["dom","Domates/biber sos"],["acios","Acı sos"],["salca","Salça"],["sirke","Sirke"],["konserve","Konserve"]]},
      {id:'yoresel', subs:[["eriste","Erişte"],["tarhana","Tarhana"],["yufka","Yufka"],["manti","Mantı"],["kurut","Kurutulmuş"],["salca2","Salça"],["sirke2","Sirke"],["konserve2","Konserve"]]},
      {id:'diet', subs:[["fit","Fit tabaklar"],["vegan","Vegan yemekler"],["gf","GF unlu mamuller"],["sekersiz","Şekersiz tatlı"],["keto","Keto ürün"],["protein","Protein atıştırmalık"]]},
      {id:'taki', subs:[["bileklik","Bileklik"],["kolye","Kolye"],["kupe","Küpe"],["yuzuk","Yüzük"],["halhal","Halhal"],["bros","Broş"],["set","Setler"],["isimli","Kişiye özel"],["makrome","Makrome"],["dogaltas","Doğal taş"],["recine","Reçine"],["telsarma","Tel sarma"]]},
      {id:'bebek', subs:[["fig","Figürler"],["cingirak","Çıngırak"],["dis","Diş kaşıyıcı"],["bezoy","Bez oyuncak/kitap"],["montessori","Montessori"],["set2","Setler"],["patik","Patik-bere"],["battaniye","Battaniye"],["onluk","Önlük"],["lohusa","Lohusa seti"],["sac","Saç aksesuarı"],["giyim","El emeği kıyafet"]]},
      {id:'orgu', subs:[["hirka","Hırka"],["kazak","Kazak"],["atkibere","Atkı-bere"],["panco","Panço"],["sal","Şal"],["corap","Çorap"],["lif","Lif takımı"],["bebektk","Bebek takımı"],["yelek","Yelek"],["kirlen","Kırlent-örtü"],["igneoyasi","İğne oyası"]]},
      {id:'terzi', subs:[["paca","Paça/onarım"],["fermuar","Fermuar değişimi"],["perde","Perde"],["nevresim","Nevresim"],["masa","Masa örtüsü"],["ozel","Özel dikim"],["kostum","Kostüm"]]},
      {id:'makrome', subs:[["duvar","Duvar süsü"],["saksi","Saksı askısı"],["anahtar","Anahtarlık"],["avize","Avize"],["runner","Runner"],["sepet","Sepet"],["raf","Raf/dekor"]]},
      {id:'evdekor', subs:[["kece","Keçe işleri"],["kirlent","Kırlent"],["kapi","Kapı süsü"],["tepsi","Tepsi süs"],["cerceve","Çerçeve"],["ruya","Rüya kapanı"],["tablo","Tablo"]]},
      {id:'mum', subs:[["soya","Soya/balmumu"],["tas","Kokulu taş"],["sprey","Oda spreyi"],["tutsu","Tütsü"],["jel","Jel mum"],["hediye","Hediye seti"]]},
      {id:'kozmetik', subs:[["zeytin","Zeytinyağlı sabun"],["bitkisel","Bitkisel sabun"],["sampuan","Katı şampuan"],["balm","Dudak balmı"],["krem","Krem/merhem"],["banyotuzu","Banyo tuzu"],["lavanta","Lavanta kesesi"]]},
      {id:'amigurumi', subs:[["anahtar2","Anahtarlık"],["magnet","Magnet"],["kolek","Koleksiyon"],["dekorbebek","Dekor bebek"]]},
    ];

    // ===== DOM Helpers =====
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));

    const catlist = $('#catlist');
    const authModal = $('#authModal');
    const y = $('#y'); if (y) y.textContent = new Date().getFullYear();

    // Build provinces in sign-up
    const suProv = $('#su_province');
    if (suProv){ suProv.innerHTML = '<option value="" disabled selected>İl seçiniz</option>' + PROVINCES.map(p=>`<option value="${p}">${p}</option>`).join(''); }

    // ===== Language helpers =====
    const langSel = $('#lang');
    const getLang = ()=>localStorage.getItem('ue_lang')||'tr';
    const setLang = l=>{ localStorage.setItem('ue_lang', l); document.documentElement.lang = l; document.documentElement.dir = (l==='ar'?'rtl':'ltr'); };

    function tLookup(obj, path){ return path.split('.').reduce((o,k)=>o&&o[k], obj); }

    function applyI18n(){
      const L = I18N[getLang()]||I18N.tr;
      $$('[data-i18n]').forEach(el=>{ const key = el.getAttribute('data-i18n'); const val = tLookup(L, key); if (typeof val==='string') el.textContent = val; if (key==='brand') document.title = `${val} • Ana Sayfa`; });
      $$('[data-i18n-placeholder]').forEach(el=>{ const key = el.getAttribute('data-i18n-placeholder'); const val = tLookup(L, key); if (typeof val==='string') el.setAttribute('placeholder', val); });
      const vh = $('#verifyHint'); if (vh){ const val=L.auth?.verifyHint; if (val) vh.innerHTML = val; }
      // Showcase sample items REMOVED -> guard against nulls (no fake cards in DOM)
      const m1 = $('[data-i18n="item.manti.title"]'); if (m1) m1.textContent = L.item?.manti?.title||'Ev Yapımı Mantı';
      const m1m = $('[data-i18n="item.manti.meta"]'); if (m1m) m1m.textContent = L.item?.manti?.meta||'Kadıköy • 350 TL';
      const m2 = $('[data-i18n="item.makrome.title"]'); if (m2) m2.textContent = L.item?.makrome?.title||'Makrome Duvar Süsü';
      const m2m = $('[data-i18n="item.makrome.meta"]'); if (m2m) m2m.textContent = L.item?.makrome?.meta||'Konya • 420 TL';
      const m3 = $('[data-i18n="item.sabun.title"]'); if (m3) m3.textContent = L.item?.sabun?.title||'Zeytinyağlı Sabun';
      const m3m = $('[data-i18n="item.sabun.meta"]'); if (m3m) m3m.textContent = L.item?.sabun?.meta||'Ayvalık • 95 TL';
      const empty = $('[data-i18n="empty.listings"]'); if (empty && L.empty?.listings) empty.textContent = L.empty.listings;
    }

    // ===== Build Categories (titles translated; subs translated via I18N.sub if available) =====
    function buildCats(){
      const L = I18N[getLang()]||I18N.tr;
      catlist.innerHTML = '';
      CATS.forEach(cat=>{
        const row = document.createElement('div'); row.className='cat'; row.setAttribute('aria-expanded','false');
        const btn = document.createElement('button');
        const title = L.cats?.[cat.id] || cat.id;
        btn.innerHTML = `<span class="cat-title">${title}</span><span class="chev">▶</span>`;
        const sub = document.createElement('div'); sub.className='sublist';
        sub.innerHTML = cat.subs.map(([id,label])=>`<a href="/listings.html?cat=${encodeURIComponent(cat.id)}&sub=${encodeURIComponent(id)}">${(L.sub?.[id]||label)}</a>`).join('');
        btn.addEventListener('click',()=>{ const exp=row.getAttribute('aria-expanded')==='true'; row.setAttribute('aria-expanded', String(!exp)); sub.style.display = exp?'none':'block'; });
        row.append(btn, sub); catlist.append(row);
      });
    }

    // ===== Search & Navigation =====
    $('#searchBtn')?.addEventListener('click', ()=>{ const q = ($('#q')?.value||'').trim(); const url = q ? `/listings.html?q=${encodeURIComponent(q)}` : '/listings.html'; location.href = url; });
    $('#browseBtn')?.addEventListener('click', ()=>{ const first = CATS[0]?.id || ''; location.href = first ? `/listings.html?cat=${first}` : '/listings.html'; });
    $('#postBtn')?.addEventListener('click', ()=>{ location.href = '/ilan-ver.html'; });

    // ===== Auth Modal =====
    function openAuth(msg){
      if (msg) { const p=document.createElement('p'); p.className='hint'; p.textContent=msg; $('.inner', authModal).prepend(p); setTimeout(()=>p.remove(), 2600); }
      try{ if (typeof authModal.showModal==='function'){ authModal.showModal(); } else { authModal.setAttribute('open',''); } }catch{ authModal.setAttribute('open',''); }
    }
    $$('#authModal [data-close]').forEach(b=>b.addEventListener('click',()=>{ authModal.close?.(); authModal.removeAttribute('open'); }));
    $$('#showcase [data-need-auth]').forEach(el=>{ el.addEventListener('click', (ev)=>{ ev.preventDefault(); openAuth(''); }); });
    $('#signInBtn')?.addEventListener('click', ()=> openAuth(''));

    // Toggle password visibility
    $$('.toggle').forEach(b=>b.addEventListener('click',()=>{ const id=b.getAttribute('data-toggle'); const inp=document.getElementById(id); if(!inp) return; inp.type = (inp.type==='password'?'text':'password'); }));

    // ===== Firebase Auth wiring (only if auth exists) =====
    if (auth){
      onAuthStateChanged(auth, (u)=>{
        const authArea = document.getElementById('authArea'); const signBtn = document.getElementById('signInBtn');
        if (u){ authArea.style.display='flex'; signBtn.style.display='none'; $('#uName').textContent = u.displayName || u.email || 'Kullanıcı'; $('#uAvatar').src = u.photoURL || '/assets/img/avatar-default.png'; }
        else { authArea.style.display='none'; signBtn.style.display='inline-flex'; }
      });

      document.getElementById('loginBtn')?.addEventListener('click', async ()=>{
        const email = /** @type {HTMLInputElement} */(document.getElementById('li_email')).value.trim();
        const pass  = /** @type {HTMLInputElement} */(document.getElementById('li_pass')).value;
        if (!email || pass.length<6){ alert('E-posta ve şifreyi kontrol edin.'); return; }
        try{ await signInWithEmailAndPassword(auth, email, pass); authModal.close?.(); authModal.removeAttribute('open'); window.location.href = '/home.html'; }
        catch(err){ alert('Giriş başarısız: '+(err?.message||err)); }
      });

      document.getElementById('googleBtn')?.addEventListener('click', async ()=>{
        try{
          const provider = new GoogleAuthProvider();
          await signInWithPopup(auth, provider);
          authModal.close?.(); authModal.removeAttribute('open');
          window.location.href = '/home.html';
        }catch(err){ alert('Google giriş başarısız: '+(err?.message||err)); }
      });

      document.getElementById('forgotBtn')?.addEventListener('click', async ()=>{
        const email = /** @type {HTMLInputElement} */(document.getElementById('li_email')).value.trim();
        if (!email){ alert('Şifre sıfırlamak için e-posta girin.'); return; }
        try{ await sendPasswordResetEmail(auth, email); alert('Şifre sıfırlama e-postası gönderildi. Lütfen gelen kutusu ve SPAM klasörünü kontrol edin.'); }
        catch(err){ alert('İşlem başarısız: '+(err?.message||err)); }
      });

      document.getElementById('registerBtn')?.addEventListener('click', async ()=>{
        const username = /** @type {HTMLInputElement} */(document.getElementById('su_username')).value.trim();
        const name = /** @type {HTMLInputElement} */(document.getElementById('su_name')).value.trim();
        const province = /** @type {HTMLSelectElement} */(document.getElementById('su_province')).value;
        const district = /** @type {HTMLInputElement} */(document.getElementById('su_district')).value.trim();
        const email = /** @type {HTMLInputElement} */(document.getElementById('su_email')).value.trim();
        const pass = /** @type {HTMLInputElement} */(document.getElementById('su_pass')).value;
        const pass2 = /** @type {HTMLInputElement} */(document.getElementById('su_pass2')).value;
        if (!username || !name || !province || !district || !email || pass.length<6 || pass!==pass2){ alert('Lütfen tüm alanları doğru doldurun.'); return; }
        try{
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await updateProfile(cred.user, { displayName: name, photoURL: '' });
          try { await sendEmailVerification(cred.user); } catch{}
          alert('Kayıt tamamlandı. Doğrulama e-postası gönderildi. Gelen kutunuzda göremezseniz SPAM klasörünü kontrol edin.');
          authModal.close?.(); authModal.removeAttribute('open');
          window.location.href = '/home.html';
        }catch(err){ alert('Kayıt başarısız: '+(err?.message||err)); }
      });

      document.getElementById('signOutBtn')?.addEventListener('click', async ()=>{
        try{ (await import('https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js')).signOut(auth); }catch{}
      });
    } else {
      // Demo mode
      console.warn('Auth is not available (demo mode). Modal and UI still work.');
      document.getElementById('loginBtn')?.addEventListener('click', ()=>{ alert('Demo modu: Giriş simülasyonu.'); authModal.close?.(); authModal.removeAttribute('open'); window.location.href = '/home.html'; });
    }

    // ===== Hero Rotator (15s) =====
    let heroIndex = 0; const heroTitle = document.getElementById('heroTitle'); const heroDesc = document.getElementById('heroDesc');
    function setHero(){ const L=I18N[getLang()]||I18N.tr; const arr=L.heroLines||I18N.tr.heroLines; const it=arr[heroIndex % arr.length]; heroTitle.textContent=it.t; heroDesc.textContent=it.d; }
    setInterval(()=>{ heroIndex++; setHero(); }, 15000); setHero();

    // ===== Init =====
    (function init(){
      const y = document.getElementById('y'); if (y) y.textContent = new Date().getFullYear();
      const initial = getLang(); setLang(initial); langSel.value = initial; applyI18n();
      langSel.addEventListener('change', ()=>{ setLang(langSel.value); applyI18n(); buildCats(); setHero(); });
      buildCats();
    })();

    // ===== Lightweight Self-Tests =====
    (function selfTests(){
      try{ console.assert(typeof initializeApp === 'function', 'initializeApp available'); }catch{}
      try{ console.assert(!!getApps, 'getApps available'); }catch{}
      try{ console.assert(typeof openAuth === 'function' || true, 'openAuth present'); }catch{}
      try{ console.assert(document.getElementById('signInBtn'), '#signInBtn exists'); }catch{}
      try{ console.assert(document.getElementById('catlist'), '#catlist exists'); }catch{}
      if (getApps().length){ console.info('[TEST] Firebase app detected:', getApps()[0].name); } else { console.warn('[TEST] No Firebase app detected. Using demo or external /firebase-init.js.'); }
    })();
  </script>
</body>
</html>
