<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Üreten Eller • Ana Sayfa</title>
  <meta name="description" content="Üreten Eller: El emeği ürünler, yöresel lezzetler ve daha fazlası. Kategorilere göz atın, arayın, ilan verin." />
  <link rel="icon" href="/assets/icons/favicon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:#0b1220;-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    .page{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
    /* Notice bar */
    .notice-bar{position:sticky;top:0;z-index:60;width:100%;background:#111;color:#fff;text-align:center;font-weight:900;letter-spacing:.6px;padding:10px 12px;font-size:13px}

    .topbar{position:sticky;top:40px;z-index:50;backdrop-filter:saturate(140%) blur(8px);background:rgba(255,255,255,.8);border-bottom:1px solid #e5e7eb}
    .topbar-inner{max-width:1200px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}

    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{width:36px;height:36px;border-radius:10px;background:#fff url('/assets/icons/favicon.png') center/cover no-repeat;box-shadow:inset 0 0 0 1px #e5e7eb}
    .brand h1{font-size:18px;letter-spacing:.2px;margin:0;font-weight:800}

    .actions{display:flex;align-items:center;gap:8px}
    .lang{border:1px solid #e5e7eb;border-radius:10px;padding:6px 10px;font-weight:600;background:#fff}

    .wrap{max-width:1200px;margin:0 auto;padding:18px 16px;display:grid;grid-template-columns:280px 1fr;gap:16px}
    @media (max-width: 980px){.wrap{grid-template-columns:1fr}.sidebar{order:1}.content{order:2}}

    .sidebar{position:relative}
    .search{position:sticky;top:70px;background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:10px 12px;display:flex;align-items:center;gap:8px;box-shadow:0 2px 10px rgba(0,0,0,.03)}
    .search input{flex:1;border:0;outline:0;background:transparent;font-size:14px}

    .catbox{margin-top:12px;border:1px solid #e5e7eb;border-radius:16px;overflow:hidden}
    .cathead{font-size:12px;font-weight:700;letter-spacing:.4px;text-transform:uppercase;color:#6b7280;padding:10px 14px;background:#fafafa;border-bottom:1px solid #eee}
    .catlist{max-height:68vh;overflow:auto}

    .cat{border-bottom:1px dashed #eee}
    .cat:last-child{border-bottom:0}
    .cat > button{width:100%;text-align:left;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;background:#fff;border:0;cursor:pointer;font-weight:600}
    .cat > button:hover{background:#fafafa}
    .cat-title{display:flex;align-items:center;gap:8px}
    .chev{transition:transform .2s ease}
    .cat[aria-expanded="true"] .chev{transform:rotate(90deg)}

    .sublist{display:none;padding:8px 10px 14px 38px}
    .sublist a{display:block;padding:6px 4px;border-radius:8px;font-size:14px;color:#374151}
    .sublist a:hover{background:#f3f4f6}

    .hero{position:relative;border:1px solid #e5e7eb;border-radius:20px;padding:22px 18px;display:grid;grid-template-columns:1.5fr 1fr;gap:20px;align-items:center;overflow:hidden}
    .hero::after{content:"";position:absolute;inset:-60% -40% auto auto;aspect-ratio:1/1;background:radial-gradient(closest-side,rgba(255,215,0,.15),transparent 70%)}
    @media (max-width: 900px){.hero{grid-template-columns:1fr}}
    .hero h2{font-size:28px;margin:0 0 10px 0;letter-spacing:.2px}
    .hero p{margin:0 0 16px 0;color:#4b5563}

    .cta-row{display:flex;flex-wrap:wrap;gap:8px}

    .grid{margin-top:16px;display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width: 1100px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 640px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;background:#fff;box-shadow:0 10px 30px rgba(0,0,0,.04)}
    .card .ph{aspect-ratio:16/11;background:linear-gradient(180deg,#f3f4f6,#fff)}
    .card .body{padding:12px}
    .card .title{font-weight:700;margin:0 0 4px 0}
    .card .meta{font-size:12px;color:#6b7280}
    .card .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px}

    .btn{--gold:#caa552;--shine:rgba(255,255,255,.7);--ink:#0b1220;appearance:none;border:0;cursor:pointer;font-weight:800;border-radius:12px;padding:10px 14px;position:relative;isolation:isolate;transition:transform .06s ease, box-shadow .2s ease;user-select:none}
    .btn:active{transform:translateY(1px)}
    .btn.gold{color:#111;background:
        radial-gradient(120% 120% at 0% 0%, rgba(255,255,255,.75), transparent 35%),
        linear-gradient(180deg, #f7e7b5, #e8c972 40%, #d7b45d 55%, #caa552 80%, #b79343);
      border:1px solid #b18a37;box-shadow:inset 0 1px 0 var(--shine), 0 4px 18px rgba(202,165,82,.35)}
    .btn.ghost{background:#fff;border:1px solid #e5e7eb}

    .auth-badge{display:flex;align-items:center;gap:10px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px}
    .avatar{width:28px;height:28px;border-radius:50%;background:#f3f4f6;overflow:hidden}

    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.32);z-index:60;padding:16px}
    .modal[open]{display:grid}
    .sheet{width:min(520px,96vw);background:#fff;border-radius:18px;border:1px solid #e5e7eb;box-shadow:0 30px 60px rgba(0,0,0,.15);overflow:hidden}
    .sheet header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #eee}
    .sheet header h3{margin:0;font-size:18px}
    .sheet .inner{padding:16px}

    .form{display:grid;gap:10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:560px){.row2{grid-template-columns:1fr}}
    .input{display:flex;flex-direction:column;gap:6px}
    .input label{font-size:12px;color:#6b7280}
    .input input, .input select{border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;font-size:14px}
    .pw{position:relative}
    .pw input{padding-right:38px}
    .pw .toggle{position:absolute;right:8px;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer}

    .hint{font-size:12px;color:#6b7280}
    .error{color:#b91c1c}

    .legal{background:#000;color:#fff}
    .legal .inner{max-width:1200px;margin:0 auto;padding:16px}
    .legal a{color:#fff;opacity:.9}
    .legal a:hover{opacity:1;text-decoration:underline}
    .legal .links{display:flex;flex-wrap:wrap;gap:14px;align-items:center}
    .legal .row{display:flex;justify-content:space-between;align-items:center;gap:12px}
    @media (max-width:800px){.legal .row{flex-direction:column;align-items:flex-start}}

    /* Empty state for listings */
    .empty{border:1px dashed #e5e7eb; border-radius:16px; padding:18px; text-align:center; color:#6b7280; background:linear-gradient(180deg,#fafafa,#fff)}
  </style>
</head>
<body>
  <div class="page">
    <div class="notice-bar">ÜRETENELLER.COM KESİNLİKLE KOMİSYON ALMAZ</div>
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <h1 data-i18n="brand">Üreten Eller</h1>
        </div>
        <div class="actions">
          <select id="lang" class="lang" aria-label="Dil">
            <option value="tr">Türkçe</option>
            <option value="en">English</option>
            <option value="ar">العربية</option>
            <option value="de">Deutsch</option>
          </select>
          <button class="btn gold" id="postBtn" data-i18n="post">İlan Ver</button>
          <div id="authArea" class="auth-badge" style="display:none">
            <div class="avatar"><img id="uAvatar" alt="" /></div>
            <div id="uName" class="hint">Kullanıcı</div>
            <button class="btn ghost" id="signOutBtn" data-i18n="signOut">Çıkış</button>
          </div>
          <button class="btn ghost" id="signInBtn" data-i18n="signIn">Giriş / Kayıt</button>
        </div>
      </div>
    </div>

    <main class="wrap">
      <aside class="sidebar">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M15.5 15.5L21 21" stroke="#111" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#111" stroke-width="1.6"/></svg>
          <input id="q" data-i18n-placeholder="searchPlaceholder" placeholder="Ara: ürün, kategori, ilçe…" />
          <button class="btn gold" id="searchBtn" aria-label="Ara" data-i18n="search">Ara</button>
        </div>

        <div class="catbox" aria-label="Kategoriler">
          <div class="cathead" data-i18n="categories">Kategoriler</div>
          <div id="catlist" class="catlist"></div>
        </div>
      </aside>

      <section class="content">
        <div class="hero">
          <div>
            <h2 id="heroTitle">El emeği & yerel lezzetler tek çatı altında</h2>
            <p id="heroDesc">Üreten kadınlardan, ev yapımı lezzetlerden, el işi tasarımlardan alışveriş yapın. Konumunuza göre arayın, kategorilerden keşfedin.</p>
            <div class="cta-row">
              <button class="btn gold" id="browseBtn" data-i18n="browse">Kategorileri Keşfet</button>
            </div>
          </div>
          <!-- Hero'daki logo görseli kaldırıldı -->
        </div>

        <div class="grid" id="showcase">
          <div class="empty" data-i18n="empty.listings">Şimdilik gösterilecek ilan yok. Kategorilerden keşfedin veya arama yapın.</div>
        </div>
      </section>
    </main>

    <footer class="legal">
      <div class="inner">
        <div class="row">
          <div class="links">
            <a href="/legal/kullanim-sartlari.html" data-i18n="legal.terms">Kullanım Şartları</a>
            <a href="/legal/gizlilik-politikasi.html" data-i18n="legal.privacy">Gizlilik Politikası</a>
            <a href="/legal/kvkk-aydinlatma.html" data-i18n="legal.kvkk">KVKK Aydınlatma</a>
            <a href="/legal/topluluk-kurallari.html" data-i18n="legal.community">Topluluk Kuralları</a>
            <a href="/legal/yasakli-urunler.html" data-i18n="legal.prohibited">Yasaklı Ürünler</a>
            <a href="/legal/mesafeli-satis-sozlesmesi.html" data-i18n="legal.distance">Mesafeli Satış</a>
            <a href="/legal/on-bilgilendirme-formu.html" data-i18n="legal.preinfo">Ön Bilgilendirme</a>
            <a href="/legal/teslimat-iade-iptal.html" data-i18n="legal.return">Teslimat/İade</a>
            <a href="/iletisim-impressum.html" data-i18n="legal.contact">İletişim</a>
          </div>
          <div class="hint">© <span id="y"></span> <span data-i18n="brand">Üreten Eller</span></div>
        </div>
      </div>
    </footer>
  </div>

  <!-- ===== Auth Modal ===== -->
  <dialog class="modal" id="authModal" aria-labelledby="authTitle">
    <div class="sheet" role="document">
      <header>
        <h3 id="authTitle" data-i18n="auth.title">Giriş Yap / Kayıt Ol</h3>
        <button class="btn ghost" data-close aria-label="Kapat">✕</button>
      </header>
      <div class="inner">
        <div class="hint" style="margin-bottom:10px" data-i18n="auth.hint">Sipariş vermek veya profilleri ziyaret etmek için giriş yapmalısınız.</div>
        <div class="form" style="margin-bottom:16px">
          <div class="input"><label data-i18n="auth.email">E-posta</label><input id="li_email" type="email" placeholder="ornek@mail.com" autocomplete="username"/></div>
          <div class="input pw"><label data-i18n="auth.password">Şifre</label><input id="li_pass" type="password" placeholder="••••••••" autocomplete="current-password"/><button class="toggle" data-toggle="li_pass" aria-label="Şifreyi göster">👁️</button></div>
          <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
            <button class="btn gold" id="loginBtn" data-i18n="auth.login">Giriş Yap</button>
            <button class="btn ghost" id="forgotBtn" type="button" data-i18n="auth.forgot">Şifremi Unuttum</button>
          </div>
          <div style="margin-top:10px;display:flex;justify-content:center">
            <button class="btn ghost" id="googleBtn" data-i18n="auth.google">Google ile Giriş</button>
          </div>
        </div>
        <hr style="border:0;border-top:1px solid #eee;margin:8px 0 14px">
        <details>
          <summary style="cursor:pointer;font-weight:700" data-i18n="auth.noAccount">Hesabın yok mu? Kayıt ol</summary>
          <div class="form" style="margin-top:10px">
            <div class="row2">
              <div class="input"><label data-i18n="auth.username">Kullanıcı Adı</label><input id="su_username" maxlength="24" placeholder="@kullanici"/></div>
              <div class="input"><label data-i18n="auth.name">Ad Soyad</label><input id="su_name" placeholder="Adınız Soyadınız"/></div>
            </div>
            <div class="row2">
              <div class="input"><label data-i18n="auth.province">İl</label>
                <select id="su_province"></select>
              </div>
              <div class="input"><label data-i18n="auth.district">İlçe</label><input id="su_district" placeholder="İlçeniz"/></div>
            </div>
            <div class="row2">
              <div class="input"><label data-i18n="auth.email">E-posta</label><input id="su_email" type="email" placeholder="ornek@mail.com" autocomplete="email"/></div>
              <div class="input pw"><label data-i18n="auth.password">Şifre</label><input id="su_pass" type="password" placeholder="En az 6 karakter" autocomplete="new-password"/><button class="toggle" data-toggle="su_pass" aria-label="Şifreyi göster">👁️</button></div>
            </div>
            <div class="input pw"><label data-i18n="auth.password2">Şifre (Tekrar)</label><input id="su_pass2" type="password" placeholder="Şifreyi tekrar yazın" autocomplete="new-password"/><button class="toggle" data-toggle="su_pass2" aria-label="Şifreyi göster">👁️</button></div>
            <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
              <button class="btn gold" id="registerBtn" data-i18n="auth.register">Kayıt Ol</button>
              <div class="hint" id="verifyHint">Kayıtla birlikte <strong>mail doğrulama</strong> gönderilir. Gelen kutusu ve <strong>SPAM</strong> klasörünü kontrol edin.</div>
            </div>
          </div>
        </details>
      </div>
    </div>
  </dialog>

  <script type="module" src="/firebase-init.js"></script>

  <script type="module">
    import { initializeApp, getApps } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, updateProfile, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js';

    // ===== Firebase INIT =====
    let app;
    try{
      if (window.__firebaseApp) {
        app = window.__firebaseApp;
      } else if (getApps().length) {
        app = getApps()[0];
      } else if (window.FIREBASE_CONFIG) {
        app = initializeApp(window.FIREBASE_CONFIG);
        window.__firebaseApp = app;
      } else {
        const demoConfig = { apiKey: 'demo', authDomain: 'demo', projectId: 'demo', appId: 'demo' };
        app = initializeApp(demoConfig);
        window.__firebaseApp = app;
        console.warn('Demo Firebase config is in use on this page. Real init should happen in /firebase-init.js');
      }
    }catch(e){ console.error('Firebase init error:', e); }

    let auth; try { auth = app ? getAuth(app) : null; } catch(e){ console.error('getAuth error', e); auth = null; }

    // ===== I18N (unchanged) =====
    const I18N = {/* trimmed for brevity in this canvas version; keep your original I18N block here */};

    // Provinces (TR)
    const PROVINCES = ["Adana","Adıyaman","Afyonkarahisar","Ağrı","Aksaray","Amasya","Ankara","Antalya","Ardahan","Artvin","Aydın","Balıkesir","Bartın","Batman","Bayburt","Bilecik","Bingöl","Bitlis","Bolu","Burdur","Bursa","Çanakkale","Çankırı","Çorum","Denizli","Diyarbakır","Düzce","Edirne","Elazığ","Erzincan","Erzurum","Eskişehir","Gaziantep","Giresun","Gümüşhane","Hakkari","Hatay","Iğdır","Isparta","İstanbul","İzmir","Kahramanmaraş","Karabük","Karaman","Kars","Kastamonu","Kayseri","Kırıkkale","Kırklareli","Kırşehir","Kilis","Kocaeli","Konya","Kütahya","Malatya","Manisa","Mardin","Mersin","Muğla","Muş","Nevşehir","Niğde","Ordu","Osmaniye","Rize","Sakarya","Samsun","Siirt","Sinop","Sivas","Şanlıurfa","Şırnak","Tekirdağ","Tokat","Trabzon","Tunceli","Uşak","Van","Yalova","Yozgat","Zonguldak"].sort((a,b)=>a.localeCompare(b,'tr'));

    const CATS = [
      {id:'yemek', subs:[["evyemek","Ev yemekleri"],["borek","Börek-çörek"],["corba","Çorba"],["zeytiny","Zeytinyağlı"],["pilav","Pilav-makarna"],["et","Et-tavuk"],["kahvalti","Kahvaltılık"],["meze","Meze"],["dondur","Dondurulmuş"],["cocuk","Çocuk öğünleri"],["diyetvegf","Diyet/vegan/gf"]]},
      {id:'pasta', subs:[["yaspasta","Yaş pasta"],["kek","Kek-cupcake"],["kurabiye","Kurabiye"],["serbetli","Şerbetli"],["sutlu","Sütlü"],["cheese","Cheesecake"],["diyettat","Diyet tatlı"],["cikolata","Çikolata/şekerleme"],["dogumset","Doğum günü setleri"]]},
      {id:'sos', subs:[["recel","Reçel-marmelat"],["pekmez","Pekmez"],["tursu","Turşu"],["dom","Domates/biber sos"],["acios","Acı sos"],["salca","Salça"],["sirke","Sirke"],["konserve","Konserve"]]},
      {id:'yoresel', subs:[["eriste","Erişte"],["tarhana","Tarhana"],["yufka","Yufka"],["manti","Mantı"],["kurut","Kurutulmuş"],["salca2","Salça"],["sirke2","Sirke"],["konserve2","Konserve"]]},
      {id:'diet', subs:[["fit","Fit tabaklar"],["vegan","Vegan yemekler"],["gf","GF unlu mamuller"],["sekersiz","Şekersiz tatlı"],["keto","Keto ürün"],["protein","Protein atıştırmalık"]]},
      {id:'taki', subs:[["bileklik","Bileklik"],["kolye","Kolye"],["kupe","Küpe"],["yuzuk","Yüzük"],["halhal","Halhal"],["bros","Broş"],["set","Setler"],["isimli","Kişiye özel"],["makrome","Makrome"],["dogaltas","Doğal taş"],["recine","Reçine"],["telsarma","Tel sarma"]]},
      {id:'bebek', subs:[["fig","Figürler"],["cingirak","Çıngırak"],["dis","Diş kaşıyıcı"],["bezoy","Bez oyuncak/kitap"],["montessori","Montessori"],["set2","Setler"],["patik","Patik-bere"],["battaniye","Battaniye"],["onluk","Önlük"],["lohusa","Lohusa seti"],["sac","Saç aksesuarı"],["giyim","El emeği kıyafet"]]},
      {id:'orgu', subs:[["hirka","Hırka"],["kazak","Kazak"],["atkibere","Atkı-bere"],["panco","Panço"],["sal","Şal"],["corap","Çorap"],["lif","Lif takımı"],["bebektk","Bebek takımı"],["yelek","Yelek"],["kirlen","Kırlent-örtü"],["igneoyasi","İğne oyası"]]},
      {id:'terzi', subs:[["paca","Paça/onarım"],["fermuar","Fermuar değişimi"],["perde","Perde"],["nevresim","Nevresim"],["masa","Masa örtüsü"],["ozel","Özel dikim"],["kostum","Kostüm"]]},
      {id:'makrome', subs:[["duvar","Duvar süsü"],["saksi","Saksı askısı"],["anahtar","Anahtarlık"],["avize","Avize"],["runner","Runner"],["sepet","Sepet"],["raf","Raf/dekor"]]},
      {id:'evdekor', subs:[["kece","Keçe işleri"],["kirlent","Kırlent"],["kapi","Kapı süsü"],["tepsi","Tepsi süs"],["cerceve","Çerçeve"],["ruya","Rüya kapanı"],["tablo","Tablo"]]},
      {id:'mum', subs:[["soya","Soya/balmumu"],["tas","Kokulu taş"],["sprey","Oda spreyi"],["tutsu","Tütsü"],["jel","Jel mum"],["hediye","Hediye seti"]]},
      {id:'kozmetik', subs:[["zeytin","Zeytinyağlı sabun"],["bitkisel","Bitkisel sabun"],["sampuan","Katı şampuan"],["balm","Dudak balmı"],["krem","Krem/merhem"],["banyotuzu","Banyo tuzu"],["lavanta","Lavanta kesesi"]]},
      {id:'amigurumi', subs:[["anahtar2","Anahtarlık"],["magnet","Magnet"],["kolek","Koleksiyon"],["dekorbebek","Dekor bebek"]]},
    ];

    // ===== DOM Helpers =====
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));

    const catlist = $('#catlist');
    const authModal = $('#authModal');
    const y = $('#y'); if (y) y.textContent = new Date().getFullYear();

    // Build provinces in sign-up
    const suProv = $('#su_province');
    if (suProv){ suProv.innerHTML = '<option value="" disabled selected>İl seçiniz</option>' + PROVINCES.map(p=>`<option value="${p}">${p}</option>`).join(''); }

    // ===== Language helpers =====
    const langSel = $('#lang');
    const getLang = ()=>localStorage.getItem('ue_lang')||'tr';
    const setLang = l=>{ localStorage.setItem('ue_lang', l); document.documentElement.lang = l; document.documentElement.dir = (l==='ar'?'rtl':'ltr'); };

    function tLookup(obj, path){ return path.split('.').reduce((o,k)=>o&&o[k], obj); }

    function applyI18n(){
      // NOTE: supply full I18N object in production; shortened here in canvas
    }

    // ===== Build Categories =====
    function buildCats(){
      catlist.innerHTML = '';
      CATS.forEach(cat=>{
        const row = document.createElement('div'); row.className='cat'; row.setAttribute('aria-expanded','false');
        const btn = document.createElement('button');
        btn.innerHTML = `<span class="cat-title">${cat.id}</span><span class="chev">▶</span>`;
        const sub = document.createElement('div'); sub.className='sublist';
        sub.innerHTML = cat.subs.map(([id,label])=>`<a href="/listings.html?cat=${encodeURIComponent(cat.id)}&sub=${encodeURIComponent(id)}">${label}</a>`).join('');
        btn.addEventListener('click',()=>{ const exp=row.getAttribute('aria-expanded')==='true'; row.setAttribute('aria-expanded', String(!exp)); sub.style.display = exp?'none':'block'; });
        row.append(btn, sub); catlist.append(row);
      });
    }

    // ===== Search & Navigation =====
    $('#searchBtn')?.addEventListener('click', ()=>{ const q = ($('#q')?.value||'').trim(); const url = q ? `/listings.html?q=${encodeURIComponent(q)}` : '/listings.html'; location.href = url; });
    $('#browseBtn')?.addEventListener('click', ()=>{ const first = CATS[0]?.id || ''; location.href = first ? `/listings.html?cat=${first}` : '/listings.html'; });
    $('#postBtn')?.addEventListener('click', ()=>{ location.href = '/ilan-ver.html'; });

    // ===== Auth Modal helpers =====
    function openAuth(msg){
      if (msg) { const p=document.createElement('p'); p.className='hint'; p.textContent=msg; $('.inner', authModal).prepend(p); setTimeout(()=>p.remove(), 2600); }
      try{ if (typeof authModal.showModal==='function'){ authModal.showModal(); } else { authModal.setAttribute('open',''); } }catch{ authModal.setAttribute('open',''); }
    }
    $$('#authModal [data-close]').forEach(b=>b.addEventListener('click',()=>{ authModal.close?.(); authModal.removeAttribute('open'); }));

    // Always open auth modal on subcategory clicks (ALL panels)
    catlist.addEventListener('click', (ev)=>{
      const a = ev.target.closest('.sublist a');
      if (a){ ev.preventDefault(); openAuth(''); }
    });

    $('#signInBtn')?.addEventListener('click', ()=> openAuth(''));

    // Toggle password visibility
    $$('.toggle').forEach(b=>b.addEventListener('click',()=>{ const id=b.getAttribute('data-toggle'); const inp=document.getElementById(id); if(!inp) return; inp.type = (inp.type==='password'?'text':'password'); }));

    // ===== Firebase Auth wiring (only if auth exists) =====
    if (auth){
      onAuthStateChanged(auth, (u)=>{
        const authArea = document.getElementById('authArea'); const signBtn = document.getElementById('signInBtn');
        if (u){ authArea.style.display='flex'; signBtn.style.display='none'; $('#uName').textContent = u.displayName || u.email || 'Kullanıcı'; $('#uAvatar').src = u.photoURL || '/assets/img/avatar-default.png'; }
        else { authArea.style.display='none'; signBtn.style.display='inline-flex'; }
      });

      document.getElementById('loginBtn')?.addEventListener('click', async ()=>{
        const email = /** @type {HTMLInputElement} */(document.getElementById('li_email')).value.trim();
        const pass  = /** @type {HTMLInputElement} */(document.getElementById('li_pass')).value;
        if (!email || pass.length<6){ alert('E-posta ve şifreyi kontrol edin.'); return; }
        try{ await signInWithEmailAndPassword(auth, email, pass); authModal.close?.(); authModal.removeAttribute('open'); window.location.href = '/home.html'; }
        catch(err){ alert('Giriş başarısız: '+(err?.message||err)); }
      });

      document.getElementById('googleBtn')?.addEventListener('click', async ()=>{
        try{
          const provider = new GoogleAuthProvider();
          await signInWithPopup(auth, provider);
          authModal.close?.(); authModal.removeAttribute('open');
          window.location.href = '/home.html';
        }catch(err){ alert('Google giriş başarısız: '+(err?.message||err)); }
      });

      document.getElementById('forgotBtn')?.addEventListener('click', async ()=>{
        const email = /** @type {HTMLInputElement} */(document.getElementById('li_email')).value.trim();
        if (!email){ alert('Şifre sıfırlamak için e-posta girin.'); return; }
        try{ await sendPasswordResetEmail(auth, email); alert('Şifre sıfırlama e-postası gönderildi. Lütfen gelen kutusu ve SPAM klasörünü kontrol edin.'); }
        catch(err){ alert('İşlem başarısız: '+(err?.message||err)); }
      });

      document.getElementById('registerBtn')?.addEventListener('click', async ()=>{
        const username = /** @type {HTMLInputElement} */(document.getElementById('su_username')).value.trim();
        const name = /** @type {HTMLInputElement} */(document.getElementById('su_name')).value.trim();
        const province = /** @type {HTMLSelectElement} */(document.getElementById('su_province')).value;
        const district = /** @type {HTMLInputElement} */(document.getElementById('su_district')).value.trim();
        const email = /** @type {HTMLInputElement} */(document.getElementById('su_email')).value.trim();
        const pass = /** @type {HTMLInputElement} */(document.getElementById('su_pass')).value;
        const pass2 = /** @type {HTMLInputElement} */(document.getElementById('su_pass2')).value;
        if (!username || !name || !province || !district || !email || pass.length<6 || pass!==pass2){ alert('Lütfen tüm alanları doğru doldurun.'); return; }
        try{
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await updateProfile(cred.user, { displayName: name, photoURL: '' });
          try { await sendEmailVerification(cred.user); } catch{}
          alert('Kayıt tamamlandı. Doğrulama e-postası gönderildi. Gelen kutunuzda göremezseniz SPAM klasörünü kontrol edin.');
          authModal.close?.(); authModal.removeAttribute('open');
          window.location.href = '/home.html';
        }catch(err){ alert('Kayıt başarısız: '+(err?.message||err)); }
      });

      document.getElementById('signOutBtn')?.addEventListener('click', async ()=>{
        try{ (await import('https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js')).signOut(auth); }catch{}
      });
    } else {
      console.warn('Auth is not available (demo mode). Modal and UI still work.');
      document.getElementById('loginBtn')?.addEventListener('click', ()=>{ alert('Demo modu: Giriş simülasyonu.'); authModal.close?.(); authModal.removeAttribute('open'); window.location.href = '/home.html'; });
    }

    // ===== Hero Rotator (15s) =====
    let heroIndex = 0; const heroTitle = document.getElementById('heroTitle'); const heroDesc = document.getElementById('heroDesc');
    function setHero(){ heroTitle.textContent='El emeği & yerel lezzetler tek çatı altında'; heroDesc.textContent='Üreten kadınlardan, ev yapımı lezzetlerden, el işi tasarımlardan alışveriş yapın. Konumunuza göre arayın, kategorilerden keşfedin.'; }
    setInterval(()=>{ heroIndex++; setHero(); }, 15000); setHero();

    // ===== Init =====
    (function init(){
      const y = document.getElementById('y'); if (y) y.textContent = new Date().getFullYear();
      buildCats();
    })();

  </script>
</body>
</html>
