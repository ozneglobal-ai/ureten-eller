<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Üreten Eller • Ana Sayfa</title>
  <meta name="description" content="Üreten Eller: El emeği ürünler, yöresel lezzetler ve daha fazlası. Kategorilere göz atın, arayın, ilan verin." />
  <link rel="icon" href="/assets/icons/favicon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <style>
    /* ===== Reset & Base ===== */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:#0b1220;-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    /* ===== Layout ===== */
    .page{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
    .topbar{position:sticky;top:0;z-index:40;backdrop-filter:saturate(140%) blur(8px);background:rgba(255,255,255,.8);border-bottom:1px solid #e5e7eb}
    .topbar-inner{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}

    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{width:36px;height:36px;border-radius:10px;background:#000 url('/assets/icons/favicon.png') center/cover no-repeat;box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)}
    .brand h1{font-size:18px;letter-spacing:.2px;margin:0;font-weight:800}

    .actions{display:flex;align-items:center;gap:8px}

    .wrap{max-width:1200px;margin:0 auto;padding:18px 16px;display:grid;grid-template-columns:280px 1fr;gap:16px}
    @media (max-width: 980px){.wrap{grid-template-columns:1fr}.sidebar{display:none}.content{grid-column:1}}

    /* ===== Sidebar ===== */
    .sidebar{position:relative}
    .search{position:sticky;top:70px;background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:10px 12px;display:flex;align-items:center;gap:8px;box-shadow:0 2px 10px rgba(0,0,0,.03)}
    .search input{flex:1;border:0;outline:0;background:transparent;font-size:14px}

    .catbox{margin-top:12px;border:1px solid #e5e7eb;border-radius:16px;overflow:hidden}
    .cathead{font-size:12px;font-weight:700;letter-spacing:.4px;text-transform:uppercase;color:#6b7280;padding:10px 14px;background:#fafafa;border-bottom:1px solid #eee}
    .catlist{max-height:68vh;overflow:auto}

    .cat{border-bottom:1px dashed #eee}
    .cat:last-child{border-bottom:0}
    .cat > button{width:100%;text-align:left;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;background:#fff;border:0;cursor:pointer;font-weight:600}
    .cat > button:hover{background:#fafafa}
    .cat-title{display:flex;align-items:center;gap:8px}
    .chev{transition:transform .2s ease}
    .cat[aria-expanded="true"] .chev{transform:rotate(90deg)}

    .sublist{display:none;padding:8px 10px 14px 38px}
    .sublist a{display:block;padding:6px 4px;border-radius:8px;font-size:14px;color:#374151}
    .sublist a:hover{background:#f3f4f6}

    /* ===== Top Categories (MOBILE ONLY) ===== */
    .mobile-cats{display:none;position:sticky;top:60px;z-index:35;background:#fff;border-bottom:1px solid #eee}
    .mobile-cats .inner{max-width:1200px;margin:0 auto;padding:10px 16px}
    .accordion{border:1px solid #e5e7eb;border-radius:14px;overflow:hidden}
    .acc-row{border-bottom:1px dashed #eee}
    .acc-row:last-child{border-bottom:0}
    .acc-btn{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;background:#fff;border:0;cursor:pointer;font-weight:700}
    .acc-sub{display:none;padding:8px 12px 12px}
    .acc-sub a{display:block;padding:8px;border-radius:10px;font-size:14px;color:#374151}
    .acc-sub a:hover{background:#f3f4f6}
    @media (max-width:980px){.mobile-cats{display:block}}

    /* ===== Content ===== */
    .hero{position:relative;border:1px solid #e5e7eb;border-radius:20px;padding:22px 18px;display:grid;grid-template-columns:1.5fr 1fr;gap:20px;align-items:center;overflow:hidden}
    .hero::after{content:"";position:absolute;inset:-60% -40% auto auto;aspect-ratio:1/1;background:radial-gradient(closest-side,rgba(255,215,0,.15),transparent 70%)}
    @media (max-width: 900px){.hero{grid-template-columns:1fr}}
    .hero h2{font-size:28px;margin:0 0 10px 0;letter-spacing:.2px}
    .hero p{margin:0 0 16px 0;color:#4b5563}

    .cta-row{display:flex;flex-wrap:wrap;gap:8px}

    /* ===== Cards (GRID) — removed fake listings ===== */
    .grid{margin-top:16px;display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width: 1100px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 640px){.grid{grid-template-columns:1fr}}
    .empty{border:1px dashed #e5e7eb;border-radius:16px;padding:18px;text-align:center;color:#6b7280}

    /* ===== Buttons ===== */
    .btn{--gold:#caa552;--shine:rgba(255,255,255,.7);--ink:#0b1220;appearance:none;border:0;cursor:pointer;font-weight:800;border-radius:12px;padding:10px 14px;position:relative;isolation:isolate;transition:transform .06s ease, box-shadow .2s ease;user-select:none}
    .btn:active{transform:translateY(1px)}
    .btn.gold{color:#111;background:
        radial-gradient(120% 120% at 0% 0%, rgba(255,255,255,.75), transparent 35%),
        linear-gradient(180deg, #f7e7b5, #e8c972 40%, #d7b45d 55%, #caa552 80%, #b79343);
      border:1px solid #b18a37;box-shadow:inset 0 1px 0 var(--shine), 0 4px 18px rgba(202,165,82,.35)}
    .btn.ghost{background:#fff;border:1px solid #e5e7eb}

    /* ===== Auth Badge ===== */
    .auth-badge{display:flex;align-items:center;gap:10px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px}
    .avatar{width:28px;height:28px;border-radius:50%;background:#f3f4f6;overflow:hidden}

    /* ===== Lang Switcher ===== */
    .lang{display:flex;gap:6px;align-items:center}
    .lang .btn{padding:8px 10px;border-radius:10px;font-weight:700}
    .lang .btn[aria-pressed="true"]{outline:2px solid #b18a37}

    /* ===== Modals ===== */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.32);z-index:60;padding:16px}
    .modal[open]{display:grid}
    .sheet{width:min(520px,96vw);background:#fff;border-radius:18px;border:1px solid #e5e7eb;box-shadow:0 30px 60px rgba(0,0,0,.15);overflow:hidden}
    .sheet header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #eee}
    .sheet header h3{margin:0;font-size:18px}
    .sheet .inner{padding:16px}

    .form{display:grid;gap:10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:560px){.row2{grid-template-columns:1fr}}
    .input{display:flex;flex-direction:column;gap:6px}
    .input label{font-size:12px;color:#6b7280}
    .input input, .input select{border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;font-size:14px}
    .pw{position:relative}
    .pw input{padding-right:38px}
    .pw .toggle{position:absolute;right:8px;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer}

    .hint{font-size:12px;color:#6b7280}
    .error{color:#b91c1c}

    /* ===== Footer (Legal Panel) ===== */
    .legal{background:#000;color:#fff}
    .legal .inner{max-width:1200px;margin:0 auto;padding:16px}
    .legal a{color:#fff;opacity:.9}
    .legal a:hover{opacity:1;text-decoration:underline}
    .legal .links{display:flex;flex-wrap:wrap;gap:14px;align-items:center}
    .legal .row{display:flex;justify-content:space-between;align-items:center;gap:12px}
    @media (max-width:800px){.legal .row{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="page">
    <!-- ===== Topbar ===== -->
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <h1 data-i18n="brand">Üreten Eller</h1>
        </div>
        <div class="actions">
          <div class="lang" aria-label="Language">
            <label for="langSel" class="visually-hidden">Dil</label>
            <select id="langSel">
              <option value="tr">Türkçe</option>
              <option value="en">English</option>
              <option value="de">Deutsch</option>
              <option value="ar">العربية</option>
            </select>
          </div>
          <button class="btn gold" id="postBtn" data-i18n="post">İlan Ver</button>
          <div id="authArea" class="auth-badge" style="display:none">
            <div class="avatar"><img id="uAvatar" alt="" /></div>
            <div id="uName" class="hint">Kullanıcı</div>
            <button class="btn ghost" id="signOutBtn" data-i18n="signOut">Çıkış</button>
          </div>
          <button class="btn ghost" id="signInBtn" data-i18n="signIn">Giriş / Kayıt</button>
        </div>
      </div>
    </div>

    <!-- ===== Mobile Top Categories (accordion) ===== -->
    <nav class="mobile-cats" aria-label="Kategoriler (Mobil)">
      <div class="inner">
        <div class="accordion" id="mobCatAccordion"></div>
      </div>
    </nav>

    <!-- ===== Main ===== -->
    <main class="wrap">
      <!-- Sidebar: Search + Categories (hidden on mobile) -->
      <aside class="sidebar">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M15.5 15.5L21 21" stroke="#111" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#111" stroke-width="1.6"/></svg>
          <input id="q" data-i18n-ph="searchPh" placeholder="Ara: ürün, kategori, ilçe…" />
          <button class="btn gold" id="searchBtn" aria-label="Ara" data-i18n="searchBtn">Ara</button>
        </div>

        <div class="catbox" aria-label="Kategoriler">
          <div class="cathead" data-i18n="categories">Kategoriler</div>
          <div id="catlist" class="catlist"></div>
        </div>
      </aside>

      <!-- Content: Hero + grid (no fake listings) -->
      <section class="content">
        <div class="hero">
          <div>
            <h2 data-i18n="heroTitle">El emeği & yerel lezzetler tek çatı altında</h2>
            <p data-i18n="heroDesc">Üreten kadınlardan, ev yapımı lezzetlerden, el işi tasarımlardan alışveriş yapın. Konumunuza göre arayın, kategorilerden keşfedin.</p>
            <div class="cta-row">
              <button class="btn gold" id="browseBtn" data-i18n="browseCats">Kategorileri Keşfet</button>
              <button class="btn ghost" id="howBtn" data-i18n="howItWorks">Nasıl çalışır?</button>
            </div>
          </div>
          <div>
            <img alt="Üreten Eller illüstrasyon" src="/assets/icons/ureteneller.png" onerror="this.src='/assets/img/avatar-default.png'" />
          </div>
        </div>

        <div class="grid" id="showcase">
          <div class="empty" data-i18n="noListings">Şu an listelenecek ilan yok. Hemen bir ilan verin!</div>
        </div>
      </section>
    </main>

    <!-- ===== Footer / Legal ===== -->
    <footer class="legal">
      <div class="inner">
        <div class="row">
          <div class="links">
            <a href="/legal/kullanim-sartlari.html" data-i18n="legal1">Kullanım Şartları</a>
            <a href="/legal/gizlilik-politikasi.html" data-i18n="legal2">Gizlilik Politikası</a>
            <a href="/legal/kvkk-aydinlatma.html" data-i18n="legal3">KVKK Aydınlatma</a>
            <a href="/legal/topluluk-kurallari.html" data-i18n="legal4">Topluluk Kuralları</a>
            <a href="/legal/yasakli-urunler.html" data-i18n="legal5">Yasaklı Ürünler</a>
            <a href="/legal/mesafeli-satis-sozlesmesi.html" data-i18n="legal6">Mesafeli Satış</a>
            <a href="/legal/on-bilgilendirme-formu.html" data-i18n="legal7">Ön Bilgilendirme</a>
            <a href="/legal/teslimat-iade-iptal.html" data-i18n="legal8">Teslimat/İade</a>
            <a href="/iletisim-impressum.html" data-i18n="legal9">İletişim</a>
          </div>
          <div class="hint">© <span id="y"></span> <span data-i18n="brand">Üreten Eller</span></div>
        </div>
      </div>
    </footer>
  </div>

  <!-- ===== Auth Modal ===== -->
  <dialog class="modal" id="authModal">
    <div class="sheet">
      <header>
        <h3 data-i18n="authTitle">Giriş Yap / Kayıt Ol</h3>
        <button class="btn ghost" data-close>✕</button>
      </header>
      <div class="inner">
        <div class="hint" style="margin-bottom:10px" data-i18n="authHint">Sipariş vermek veya profilleri ziyaret etmek için giriş yapmalısınız.</div>
        <div class="form" style="margin-bottom:16px">
          <div class="input"><label data-i18n="email">E‑posta</label><input id="li_email" type="email" placeholder="ornek@mail.com" autocomplete="username"/></div>
          <div class="input pw"><label data-i18n="password">Şifre</label><input id="li_pass" type="password" placeholder="••••••••" autocomplete="current-password"/><button class="toggle" data-toggle="li_pass" aria-label="Şifreyi göster">👁️</button></div>
          <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
            <button class="btn gold" id="loginBtn" data-i18n="login">Giriş Yap</button>
            <button class="btn ghost" id="forgotBtn" type="button" data-i18n="forgot">Şifremi Unuttum</button>
          </div>
        </div>
        <hr style="border:0;border-top:1px solid #eee;margin:8px 0 14px">
        <details>
          <summary style="cursor:pointer;font-weight:700" data-i18n="noAccount">Hesabın yok mu? Kayıt ol</summary>
          <div class="form" style="margin-top:10px">
            <div class="row2">
              <div class="input"><label data-i18n="username">Kullanıcı Adı</label><input id="su_username" maxlength="24" placeholder="@kullanici"/></div>
              <div class="input"><label data-i18n="fullname">Ad Soyad</label><input id="su_name" placeholder="Adınız Soyadınız"/></div>
            </div>
            <div class="row2">
              <div class="input"><label data-i18n="province">İl</label>
                <select id="su_province"></select>
              </div>
              <div class="input"><label data-i18n="district">İlçe</label><input id="su_district" placeholder="İlçeniz"/></div>
            </div>
            <div class="row2">
              <div class="input"><label data-i18n="email">E‑posta</label><input id="su_email" type="email" placeholder="ornek@mail.com" autocomplete="email"/></div>
              <div class="input pw"><label data-i18n="password">Şifre</label><input id="su_pass" type="password" placeholder="En az 6 karakter" autocomplete="new-password"/><button class="toggle" data-toggle="su_pass" aria-label="Şifreyi göster">👁️</button></div>
            </div>
            <div class="input pw"><label data-i18n="password2">Şifre (Tekrar)</label><input id="su_pass2" type="password" placeholder="Şifreyi tekrar yazın" autocomplete="new-password"/><button class="toggle" data-toggle="su_pass2" aria-label="Şifreyi göster">👁️</button></div>
            <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
              <button class="btn gold" id="registerBtn" data-i18n="register">Kayıt Ol</button>
              <div class="hint" data-i18n="verifyHint">Kayıtla birlikte <strong>mail doğrulama</strong> gönderilir. Gelen kutusu ve <strong>SPAM</strong> klasörünü kontrol edin.</div>
            </div>
          </div>
        </details>
      </div>
    </div>
  </dialog>

  <!-- ===== Scripts ===== -->
  <!-- Firebase init (kökten) -->
  <script type="module" src="/firebase-init.js"></script>

  <script type="module">
    // ===== Imports (Auth helpers) =====
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, sendEmailVerification, updateProfile, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js';

    // ===== i18n dictionaries =====
    const I18N = {
      tr: {
        brand:"Üreten Eller", post:"İlan Ver", signIn:"Giriş / Kayıt", signOut:"Çıkış",
        searchPh:"Ara: ürün, kategori, ilçe…", searchBtn:"Ara", categories:"Kategoriler",
        heroTitle:"El emeği & yerel lezzetler tek çatı altında",
        heroDesc:"Üreten kadınlardan, ev yapımı lezzetlerden, el işi tasarımlardan alışveriş yapın. Konumunuza göre arayın, kategorilerden keşfedin.",
        browseCats:"Kategorileri Keşfet", howItWorks:"Nasıl çalışır?", noListings:"Şu an listelenecek ilan yok. Hemen bir ilan verin!",
        authTitle:"Giriş Yap / Kayıt Ol", authHint:"Sipariş vermek veya profilleri ziyaret etmek için giriş yapmalısınız.",
        email:"E‑posta", password:"Şifre", password2:"Şifre (Tekrar)", login:"Giriş Yap", forgot:"Şifremi Unuttum",
        noAccount:"Hesabın yok mu? Kayıt ol", username:"Kullanıcı Adı", fullname:"Ad Soyad",
        province:"İl", district:"İlçe", register:"Kayıt Ol", verifyHint:"Kayıtla birlikte <strong>mail doğrulama</strong> gönderilir. Gelen kutusu ve <strong>SPAM</strong> klasörünü kontrol edin.",
        legal1:"Kullanım Şartları", legal2:"Gizlilik Politikası", legal3:"KVKK Aydınlatma", legal4:"Topluluk Kuralları",
        legal5:"Yasaklı Ürünler", legal6:"Mesafeli Satış", legal7:"Ön Bilgilendirme", legal8:"Teslimat/İade", legal9:"İletişim",
        catTitles:{
          yemek:"🍲 Yemekler", pasta:"🎂 Pasta & Tatlı", sos:"🫙 Reçel • Turşu • Sos", yoresel:"🌾 Yöresel / Kışlık",
          diet:"🥗 Diyet / Vegan / GF", taki:"💍 Takı", bebek:"👶 Bebek & Çocuk", orgu:"🧶 Örgü / Triko",
          terzi:"✂️ Dikiş / Terzilik", makrome:"🧵 Makrome & Dekor", evdekor:"🏠 Ev Dekor & Aksesuar",
          mum:"🕯️ Mum & Kokulu", kozmetik:"🧼 Doğal Sabun & Kozmetik", amigurumi:"🧸 Amigurumi & Oyuncak"
        },
        subLabels:{
          evyemek:"Ev yemekleri", borek:"Börek-çörek", corba:"Çorba", zeytiny:"Zeytinyağlı", pilav:"Pilav-makarna", et:"Et-tavuk", kahvalti:"Kahvaltılık", meze:"Meze", dondur:"Dondurulmuş", cocuk:"Çocuk öğünleri", diyetvegf:"Diyet/vegan/gf",
          yaspasta:"Yaş pasta", kek:"Kek-cupcake", kurabiye:"Kurabiye", serbetli:"Şerbetli", sutlu:"Sütlü", cheese:"Cheesecake", diyettat:"Diyet tatlı", cikolata:"Çikolata/şekerleme", dogumset:"Doğum günü setleri",
          recel:"Reçel-marmelat", pekmez:"Pekmez", tursu:"Turşu", dom:"Domates/biber sos", acios:"Acı sos", salca:"Salça", sirke:"Sirke", konserve:"Konserve",
          eriste:"Erişte", tarhana:"Tarhana", yufka:"Yufka", manti:"Mantı", kurut:"Kurutulmuş", salca2:"Salça", sirke2:"Sirke", konserve2:"Konserve",
          fit:"Fit tabaklar", vegan:"Vegan yemekler", gf:"GF unlu mamuller", sekersiz:"Şekersiz tatlı", keto:"Keto ürün", protein:"Protein atıştırmalık",
          bileklik:"Bileklik", kolye:"Kolye", kupe:"Küpe", yuzuk:"Yüzük", halhal:"Halhal", bros:"Broş", set:"Setler", isimli:"Kişiye özel", makrome:"Makrome", dogaltas:"Doğal taş", recine:"Reçine", telsarma:"Tel sarma",
          fig:"Figürler", cingirak:"Çıngırak", dis:"Diş kaşıyıcı", bezoy:"Bez oyuncak/kitap", montessori:"Montessori", set2:"Setler", patik:"Patik-bere", battaniye:"Battaniye", onluk:"Önlük", lohusa:"Lohusa seti", sac:"Saç aksesuarı", giyim:"El emeği kıyafet",
          hırka:"Hırka", hırka2:"Hırka", hirka:"Hırka", kazak:"Kazak", atkibere:"Atkı-bere", panco:"Panço", sal:"Şal", corap:"Çorap", lif:"Lif takımı", bepektk:"Bebek takımı", bebektk:"Bebek takımı", yelek:"Yelek", kirlen:"Kırlent-örtü", igneoyasi:"İğne oyası",
          paca:"Paça/onarım", fermuar:"Fermuar değişimi", perde:"Perde", nevresim:"Nevresim", masa:"Masa örtüsü", ozel:"Özel dikim", kostum:"Kostüm",
          duvar:"Duvar süsü", saksı:"Saksı askısı", saksı2:"Saksı askısı", saksıask:"Saksı askısı", saski:"Saksı askısı", saksıaskısı:"Saksı askısı", saksıaskisi:"Saksı askısı", saksıaskı:"Saksı askısı", saksıaski:"Saksı askısı", saksıaskısı2:"Saksı askısı", saski2:"Saksı askısı", saksıaskisi2:"Saksı askısı", saksıaski2:"Saksı askısı", saski3:"Saksı askısı", saksıask3:"Saksı askısı", saksıask4:"Saksı askısı", saksıask5:"Saksı askısı", saksıask6:"Saksı askısı", saksıask7:"Saksı askısı", saksıask8:"Saksı askısı",
          saksıaskısıx:"Saksı askısı", anahtar:"Anahtarlık", avize:"Avize", runner:"Runner", sepet:"Sepet", raf:"Raf/dekor",
          kece:"Keçe işleri", kirlent:"Kırlent", kapi:"Kapı süsü", tepsi:"Tepsi süs", cerceve:"Çerçeve", ruya:"Rüya kapanı", tablo:"Tablo",
          soya:"Soya/balmumu", tas:"Kokulu taş", sprey:"Oda spreyi", tutsu:"Tütsü", jel:"Jel mum", hediye:"Hediye seti",
          zeytin:"Zeytinyağlı sabun", bitkisel:"Bitkisel sabun", sampuan:"Katı şampuan", sampuan2:"Katı şampuan", sampuan:"Katı şampuan", balm:"Dudak balmı", krem:"Krem/merhem", banyotuzu:"Banyo tuzu", lavanta:"Lavanta kesesi",
          anahtar2:"Anahtarlık", magnet:"Magnet", kolek:"Koleksiyon", dekorbebek:"Dekor bebek"
        }
      },
      en: {
        brand:"Ureten Eller", post:"Post", signIn:"Sign in / Register", signOut:"Sign out",
        searchPh:"Search: product, category, district…", searchBtn:"Search", categories:"Categories",
        heroTitle:"Handmade & local flavors under one roof",
        heroDesc:"Shop from women producers: homemade food and handmade designs. Search by your location or browse by categories.",
        browseCats:"Browse Categories", howItWorks:"How it works?", noListings:"No listings yet. Post one now!",
        authTitle:"Sign in / Register", authHint:"You must sign in to order or view profiles.",
        email:"Email", password:"Password", password2:"Password (Repeat)", login:"Sign in", forgot:"Forgot Password",
        noAccount:"No account? Register", username:"Username", fullname:"Full Name",
        province:"Province", district:"District", register:"Register", verifyHint:"A <strong>verification email</strong> will be sent. Check Inbox and <strong>SPAM</strong>.",
        legal1:"Terms of Use", legal2:"Privacy Policy", legal3:"KVKK Notice", legal4:"Community Guidelines", legal5:"Prohibited Items", legal6:"Distance Sales", legal7:"Pre-Information", legal8:"Delivery/Returns", legal9:"Contact",
        catTitles:{
          yemek:"🍲 Meals", pasta:"🎂 Cake & Dessert", sos:"🫙 Jam • Pickle • Sauce", yoresel:"🌾 Local / Pantry",
          diet:"🥗 Diet / Vegan / GF", taki:"💍 Jewelry", bebek:"👶 Baby & Kids", orgu:"🧶 Knit / Crochet",
          terzi:"✂️ Sewing / Tailor", makrome:"🧵 Macrame & Decor", evdekor:"🏠 Home Decor & Accessories",
          mum:"🕯️ Candles & Aroma", kozmetik:"🧼 Natural Soap & Cosmetics", amigurumi:"🧸 Amigurumi & Toys"
        }
      },
      de: {
        brand:"Ureten Eller", post:"Anzeige aufgeben", signIn:"Anmelden / Registrieren", signOut:"Abmelden",
        searchPh:"Suche: Produkt, Kategorie, Bezirk…", searchBtn:"Suchen", categories:"Kategorien",
        heroTitle:"Handgemachtes & lokale Köstlichkeiten unter einem Dach",
        heroDesc:"Kaufen Sie bei Produzentinnen: Hausgemachtes und Handarbeiten. Nach Standort suchen oder Kategorien durchstöbern.",
        browseCats:"Kategorien entdecken", howItWorks:"Wie funktioniert's?", noListings:"Noch keine Anzeigen. Jetzt eine erstellen!",
        authTitle:"Anmelden / Registrieren", authHint:"Zum Bestellen oder Profil ansehen bitte anmelden.",
        email:"E‑Mail", password:"Passwort", password2:"Passwort (Wiederholen)", login:"Anmelden", forgot:"Passwort vergessen",
        noAccount:"Kein Konto? Registrieren", username:"Benutzername", fullname:"Vollständiger Name",
        province:"Provinz", district:"Bezirk", register:"Registrieren", verifyHint:"Es wird eine <strong>Bestätigungs‑E‑Mail</strong> gesendet. Posteingang und <strong>SPAM</strong> prüfen.",
        catTitles:{
          yemek:"🍲 Gerichte", pasta:"🎂 Kuchen & Dessert", sos:"🫙 Marmelade • Gurken • Soße", yoresel:"🌾 Regional / Vorrat",
          diet:"🥗 Diät / Vegan / GF", taki:"💍 Schmuck", bebek:"👶 Baby & Kinder", orgu:"🧶 Strick / Häkeln",
          terzi:"✂️ Nähen / Schneider", makrome:"🧵 Makramee & Deko", evdekor:"🏠 Wohndeko & Zubehör",
          mum:"🕯️ Kerzen & Düfte", kozmetik:"🧼 Naturseife & Kosmetik", amigurumi:"🧸 Amigurumi & Spielzeug"
        }
      },
      ar: {
        brand:"أُنتِجَت بالأيادي", post:"أنشئ إعلانًا", signIn:"تسجيل الدخول / إنشاء حساب", signOut:"تسجيل الخروج",
        searchPh:"ابحث: منتج، فئة، حي…", searchBtn:"بحث", categories:"الفئات",
        heroTitle:"منتجات يدوية ونكهات محلية تحت سقف واحد",
        heroDesc:"تسوّق من المنتجـات النسائية: أطعمة منزلية وتصاميم يدوية. ابحث حسب موقعك أو تصفّح حسب الفئات.",
        browseCats:"استكشف الفئات", howItWorks:"كيف يعمل؟", noListings:"لا توجد إعلانات بعد. أنشئ إعلانًا الآن!",
        authTitle:"تسجيل الدخول / إنشاء حساب", authHint:"يلزم تسجيل الدخول للطلب أو عرض الملفات الشخصية.",
        email:"البريد الإلكتروني", password:"كلمة المرور", password2:"تأكيد كلمة المرور", login:"تسجيل الدخول", forgot:"نسيت كلمة المرور",
        noAccount:"لا تملك حسابًا؟ سجّل الآن", username:"اسم المستخدم", fullname:"الاسم الكامل",
        province:"الولاية", district:"المنطقة", register:"تسجيل", verifyHint:"سيتم إرسال <strong>بريد تحقق</strong>. تحقّق من الوارد و<strong>الرسائل المزعجة</strong>.",
        catTitles:{
          yemek:"🍲 وجبات", pasta:"🎂 كيك وحلويات", sos:"🫙 مربى • مخلل • صوص", yoresel:"🌾 محلي / مؤونة",
          diet:"🥗 حمية / نباتي / خالٍ من الغلوتين", taki:"💍 حُلي", bebek:"👶 أطفال", orgu:"🧶 حياكة / كروشيه",
          terzi:"✂️ خياطة / تفصيل", makrome:"🧵 ماكرامي وديكور", evdekor:"🏠 ديكور المنزل والإكسسوارات",
          mum:"🕯️ شموع وروائح", kozmetik:"🧼 صابون طبيعي ومستحضرات", amigurumi:"🧸 أميغورومي وألعاب"
        }
      }
    };

    // Provinces (TR) — left as Turkish canonical list
    const PROVINCES = ["Adana","Adıyaman","Afyonkarahisar","Ağrı","Aksaray","Amasya","Ankara","Antalya","Ardahan","Artvin","Aydın","Balıkesir","Bartın","Batman","Bayburt","Bilecik","Bingöl","Bitlis","Bolu","Burdur","Bursa","Çanakkale","Çankırı","Çorum","Denizli","Diyarbakır","Düzce","Edirne","Elazığ","Erzincan","Erzurum","Eskişehir","Gaziantep","Giresun","Gümüşhane","Hakkari","Hatay","Iğdır","Isparta","İstanbul","İzmir","Kahramanmaraş","Karabük","Karaman","Kars","Kastamonu","Kayseri","Kırıkkale","Kırklareli","Kırşehir","Kilis","Kocaeli","Konya","Kütahya","Malatya","Manisa","Mardin","Mersin","Muğla","Muş","Nevşehir","Niğde","Ordu","Osmaniye","Rize","Sakarya","Samsun","Siirt","Sinop","Sivas","Şanlıurfa","Şırnak","Tekirdağ","Tokat","Trabzon","Tunceli","Uşak","Van","Yalova","Yozgat","Zonguldak"].sort((a,b)=>a.localeCompare(b,'tr'));

    // Categories (ids only; titles/sub labels come from I18N)
    const CATS = [
      {id:'yemek', subs:[["evyemek","evyemek"],["borek","borek"],["corba","corba"],["zeytiny","zeytiny"],["pilav","pilav"],["et","et"],["kahvalti","kahvalti"],["meze","meze"],["dondur","dondur"],["cocuk","cocuk"],["diyetvegf","diyetvegf"]]},
      {id:'pasta', subs:[["yaspasta","yaspasta"],["kek","kek"],["kurabiye","kurabiye"],["serbetli","serbetli"],["sutlu","sutlu"],["cheese","cheese"],["diyettat","diyettat"],["cikolata","cikolata"],["dogumset","dogumset"]]},
      {id:'sos', subs:[["recel","recel"],["pekmez","pekmez"],["tursu","tursu"],["dom","dom"],["acios","acios"],["salca","salca"],["sirke","sirke"],["konserve","konserve"]]},
      {id:'yoresel', subs:[["eriste","eriste"],["tarhana","tarhana"],["yufka","yufka"],["manti","manti"],["kurut","kurut"],["salca2","salca2"],["sirke2","sirke2"],["konserve2","konserve2"]]},
      {id:'diet', subs:[["fit","fit"],["vegan","vegan"],["gf","gf"],["sekersiz","sekersiz"],["keto","keto"],["protein","protein"]]},
      {id:'taki', subs:[["bileklik","bileklik"],["kolye","kolye"],["kupe","kupe"],["yuzuk","yuzuk"],["halhal","halhal"],["bros","bros"],["set","set"],["isimli","isimli"],["makrome","makrome"],["dogaltas","dogaltas"],["recine","recine"],["telsarma","telsarma"]]},
      {id:'bebek', subs:[["fig","fig"],["cingirak","cingirak"],["dis","dis"],["bezoy","bezoy"],["montessori","montessori"],["set2","set2"],["patik","patik"],["battaniye","battaniye"],["onluk","onluk"],["lohusa","lohusa"],["sac","sac"],["giyim","giyim"]]},
      {id:'orgu', subs:[["hirka","hirka"],["kazak","kazak"],["atkibere","atkibere"],["panco","panco"],["sal","sal"],["corap","corap"],["lif","lif"],["bebektk","bebektk"],["yelek","yelek"],["kirlen","kirlen"],["igneoyasi","igneoyasi"]]},
      {id:'terzi', subs:[["paca","paca"],["fermuar","fermuar"],["perde","perde"],["nevresim","nevresim"],["masa","masa"],["ozel","ozel"],["kostum","kostum"]]},
      {id:'makrome', subs:[["duvar","duvar"],["saksi","saksi"],["anahtar","anahtar"],["avize","avize"],["runner","runner"],["sepet","sepet"],["raf","raf"]]},
      {id:'evdekor', subs:[["kece","kece"],["kirlent","kirlent"],["kapi","kapi"],["tepsi","tepsi"],["cerceve","cerceve"],["ruya","ruya"],["tablo","tablo"]]},
      {id:'mum', subs:[["soya","soya"],["tas","tas"],["sprey","sprey"],["tutsu","tutsu"],["jel","jel"],["hediye","hediye"]]},
      {id:'kozmetik', subs:[["zeytin","zeytin"],["bitkisel","bitkisel"],["sampuan","sampuan"],["balm","balm"],["krem","krem"],["banyotuzu","banyotuzu"],["lavanta","lavanta"]]},
      {id:'amigurumi', subs:[["anahtar2","anahtar2"],["magnet","magnet"],["kolek","kolek"],["dekorbebek","dekorbebek"]]},
    ];

    // ===== DOM =====
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
    const catlist = $('#catlist');
    const mobAcc = $('#mobCatAccordion');
    const authModal = $('#authModal');
    const y = $('#y'); y.textContent = new Date().getFullYear();

    // Build provinces in sign-up
    const suProv = $('#su_province');
    if (suProv){
      suProv.innerHTML = '<option value="" disabled selected>İl seçiniz</option>' + PROVINCES.map(p=>`<option value="${p}">${p}</option>`).join('');
    }

    // ===== i18n helpers =====
    const getLang = ()=> localStorage.getItem('lang') || 'tr';
    function setLang(l){
      localStorage.setItem('lang', l);
      applyLang(l);
    }
    function t(key, l=getLang()){
      // support nested keys like catTitles.yemek
      const dict = I18N[l] || I18N.tr;
      return key.split('.').reduce((o,k)=> (o&&o[k]!==undefined)?o[k]:null, dict) ?? (I18N.tr[key]||key);
    }
    function applyDir(l){
      const html = document.documentElement;
      if (l==='ar'){ html.setAttribute('dir','rtl'); html.setAttribute('lang','ar'); }
      else { html.setAttribute('dir','ltr'); html.setAttribute('lang', l); }
    }
    function translateStatic(l){
      $$('[data-i18n]').forEach(el=>{ el.innerHTML = t(el.getAttribute('data-i18n'), l); });
      $$('[data-i18n-ph]').forEach(el=>{ el.setAttribute('placeholder', t(el.getAttribute('data-i18n-ph'), l)); });
    }

    // Build categories (sidebar + mobile accordion) with translations
    function buildCats(l=getLang()){
      // Sidebar
      if (catlist){
        catlist.innerHTML = '';
        CATS.forEach(cat=>{
          const row = document.createElement('div');
          row.className = 'cat';
          row.setAttribute('aria-expanded','false');
          const btn = document.createElement('button');
          btn.className = 'cat-btn';
          btn.innerHTML = `<span class="cat-title">${t(`catTitles.${cat.id}`, l)}</span><span class="chev">▶</span>`;
          const sub = document.createElement('div');
          sub.className = 'sublist';
          sub.innerHTML = cat.subs.map(([id,label])=>`<a href="/listings.html?cat=${encodeURIComponent(cat.id)}&sub=${encodeURIComponent(id)}">${t(`subLabels.${label}`, l) || label}</a>`).join('');
          btn.addEventListener('click', ()=>{
            const exp = row.getAttribute('aria-expanded')==='true';
            row.setAttribute('aria-expanded', String(!exp));
            sub.style.display = exp ? 'none' : 'block';
          });
          row.appendChild(btn); row.appendChild(sub);
          catlist.appendChild(row);
        });
      }
      // Mobile accordion
      if (mobAcc){
        mobAcc.innerHTML = '';
        CATS.forEach(cat=>{
          const r = document.createElement('div');
          r.className = 'acc-row';
          const b = document.createElement('button');
          b.className = 'acc-btn';
          b.innerHTML = `<span>${t(`catTitles.${cat.id}`, l)}</span><span>▾</span>`;
          const sub = document.createElement('div');
          sub.className = 'acc-sub';
          sub.innerHTML = cat.subs.map(([id,label])=>`<a href="/listings.html?cat=${encodeURIComponent(cat.id)}&sub=${encodeURIComponent(id)}">${t(`subLabels.${label}`, l) || label}</a>`).join('');
          b.addEventListener('click', ()=>{ sub.style.display = sub.style.display==='block' ? 'none' : 'block'; });
          r.appendChild(b); r.appendChild(sub);
          mobAcc.appendChild(r);
        });
      }
    }

    function applyLang(l){
      // Update pressed state on buttons
      $$('.lang [data-lang]').forEach(btn=> btn.setAttribute('aria-pressed', String(btn.getAttribute('data-lang')===l)));
      applyDir(l);
      translateStatic(l);
      buildCats(l);
    }

    // init language
    applyLang(getLang());

    // language dropdown
    const langSel = document.getElementById('langSel');
    if (langSel){
      langSel.addEventListener('change', ()=> setLang(langSel.value));
    }

    // ===== Search =====
    $('#searchBtn')?.addEventListener('click', ()=>{
      const q = ($('#q')?.value||'').trim();
      const url = q ? `/listings.html?q=${encodeURIComponent(q)}` : '/listings.html';
      location.href = url;
    });

    $('#browseBtn')?.addEventListener('click', ()=>{
      const first = CATS[0]?.id || '';
      location.href = first ? `/listings.html?cat=${first}` : '/listings.html';
    });

    // Post listing -> ilan-ver.html (auth gerekli)
    $('#postBtn')?.addEventListener('click', ()=>{ location.href = '/ilan-ver.html'; });

    // Need-auth triggers — showcase has no fake items anymore; placeholder only

    function openAuth(msg){
      if (msg) {
        const p = document.createElement('p'); p.className = 'hint'; p.innerHTML = msg; $('.inner', authModal).prepend(p); setTimeout(()=>p.remove(), 2600);
      }
      authModal.showModal();
    }
    $$('#authModal [data-close]').forEach(b=>b.addEventListener('click',()=>authModal.close()));

    // Toggle password visibility
    $$('.toggle').forEach(b=>b.addEventListener('click',()=>{
      const id = b.getAttribute('data-toggle'); const inp = document.getElementById(id);
      if (!inp) return; inp.type = (inp.type==='password' ? 'text' : 'password');
    }));

    // ===== Firebase Auth =====
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    const signInBtn = document.getElementById('signInBtn');
    const signOutBtn = document.getElementById('signOutBtn');

    signInBtn?.addEventListener('click', ()=> authModal.showModal());

    // Email/Password login
    document.getElementById('loginBtn')?.addEventListener('click', async ()=>{
      const email = /** @type {HTMLInputElement} */(document.getElementById('li_email')).value.trim();
      const pass  = /** @type {HTMLInputElement} */(document.getElementById('li_pass')).value;
      if (!email || pass.length<6){ alert('E‑posta ve şifreyi kontrol edin. / Check email & password.'); return; }
      try{ await signInWithEmailAndPassword(auth, email, pass); authModal.close(); }
      catch(err){ alert('Giriş başarısız / Sign-in failed: '+(err?.message||err)); }
    });

    // Google popup used as info button here
    const howBtn = document.getElementById('howBtn');
    howBtn?.addEventListener('click', async ()=>{
      try{ await signInWithPopup(auth, provider); authModal.close(); }
      catch{ alert('Google ile hızlı giriş yapabilirsiniz. / You can quickly sign in with Google.'); }
    });

    // Forgot password
    document.getElementById('forgotBtn')?.addEventListener('click', async ()=>{
      const email = /** @type {HTMLInputElement} */(document.getElementById('li_email')).value.trim();
      if (!email){ alert('Şifre sıfırlamak için e‑posta girin. / Enter email to reset password.'); return; }
      try{ await sendPasswordResetEmail(auth, email); alert('Şifre sıfırlama e‑postası gönderildi. / Password reset email sent.'); }
      catch(err){ alert('İşlem başarısız / Failed: '+(err?.message||err)); }
    });

    // Register
    document.getElementById('registerBtn')?.addEventListener('click', async ()=>{
      const username = /** @type {HTMLInputElement} */(document.getElementById('su_username')).value.trim();
      const name = /** @type {HTMLInputElement} */(document.getElementById('su_name')).value.trim();
      const province = /** @type {HTMLSelectElement} */(document.getElementById('su_province')).value;
      const district = /** @type {HTMLInputElement} */(document.getElementById('su_district')).value.trim();
      const email = /** @type {HTMLInputElement} */(document.getElementById('su_email')).value.trim();
      const pass = /** @type {HTMLInputElement} */(document.getElementById('su_pass')).value;
      const pass2 = /** @type {HTMLInputElement} */(document.getElementById('su_pass2')).value;
      if (!username || !name || !province || !district || !email || pass.length<6 || pass!==pass2){
        alert('Lütfen tüm alanları doğru doldurun. / Please fill in all fields correctly.'); return;
      }
      try{
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await updateProfile(cred.user, { displayName: name, photoURL: '' });
        try { await sendEmailVerification(cred.user); } catch{}
        alert('Kayıt tamamlandı. Doğrulama e‑postası gönderildi. / Registration complete. Verification email sent.');
        authModal.close();
      }catch(err){ alert('Kayıt başarısız / Registration failed: '+(err?.message||err)); }
    });

    // Sign out
    signOutBtn?.addEventListener('click', async ()=>{ try{ await (await import('https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js')).signOut(auth); }catch{} });

    // Auth state UI
    onAuthStateChanged(auth, (u)=>{
      const authArea = document.getElementById('authArea');
      const signBtn = document.getElementById('signInBtn');
      if (u){
        authArea.style.display='flex'; signBtn.style.display='none';
        document.getElementById('uName').textContent = u.displayName || u.email || 'Kullanıcı';
        document.getElementById('uAvatar').src = u.photoURL || '/assets/img/avatar-default.png';
      } else {
        authArea.style.display='none'; signBtn.style.display='inline-flex';
      }
    });
  </script>
</body>
</html>
